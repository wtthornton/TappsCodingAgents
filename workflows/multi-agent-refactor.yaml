# Multi-Agent Refactoring Workflow
# Refactors multiple components in parallel using dependency-based parallelism

workflow:
  id: multi-agent-refactor
  name: "Multi-Agent Refactoring Workflow"
  description: "Refactor multiple components concurrently"
  version: "1.0.0"
  
  type: brownfield
  
  settings:
    quality_gates: true
    code_scoring: true
    context_tier_default: 2
  
  # Refactor steps - run in parallel (no dependencies)
  steps:
    - id: auth-refactor
      agent: improver
      action: refactor
      context_tier: 3
      requires: []
      creates:
        - services/auth/refactored/
      metadata:
        instruction: "Refactor to use dependency injection and improve error handling"
      
    - id: api-refactor
      agent: improver
      action: refactor
      context_tier: 3
      requires: []
      creates:
        - services/api/refactored/
      metadata:
        instruction: "Refactor to improve code organization and add type hints"
      
    - id: payment-refactor
      agent: improver
      action: refactor
      context_tier: 3
      requires: []
      creates:
        - services/payment/refactored/
      metadata:
        instruction: "Refactor to improve security and error handling"
    
    # Review steps - run in parallel after refactors complete
    - id: auth-review
      agent: reviewer
      action: review_code
      context_tier: 2
      requires:
        - services/auth/refactored/
      creates:
        - services/auth/review-report.json
      
    - id: api-review
      agent: reviewer
      action: review_code
      context_tier: 2
      requires:
        - services/api/refactored/
      creates:
        - services/api/review-report.json
      
    - id: payment-review
      agent: reviewer
      action: review_code
      context_tier: 2
      requires:
        - services/payment/refactored/
      creates:
        - services/payment/review-report.json
  
    # Aggregate step - waits for all reviews
    - id: aggregate
      agent: orchestrator
      action: aggregate_results
      context_tier: 1
      requires:
        - services/auth/review-report.json
        - services/api/review-report.json
        - services/payment/review-report.json
      creates:
        - refactoring-results.json


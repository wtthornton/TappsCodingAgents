# Multi-Agent Review and Test Workflow
# Demonstrates parallel execution of multiple agents using dependency-based parallelism

workflow:
  id: multi-agent-review-and-test
  name: "Multi-Agent Review and Test Workflow"
  description: "Review multiple services and generate tests in parallel"
  version: "1.0.0"
  
  type: brownfield
  
  settings:
    quality_gates: true
    code_scoring: true
    context_tier_default: 2
  
  # All steps with no dependencies run in parallel automatically
  steps:
    # Review tasks - run in parallel (no dependencies)
    - id: auth-reviewer
      agent: reviewer
      action: review_code
      context_tier: 2
      requires: []
      creates:
        - services/auth/review-report.json
      
    - id: api-reviewer
      agent: reviewer
      action: review_code
      context_tier: 2
      requires: []
      creates:
        - services/api/review-report.json
      
    - id: payment-reviewer
      agent: reviewer
      action: review_code
      context_tier: 2
      requires: []
      creates:
        - services/payment/review-report.json
    
    # Test generation tasks - run in parallel (no dependencies)
    - id: auth-tester
      agent: tester
      action: write_tests
      context_tier: 2
      requires: []
      creates:
        - services/auth/tests/
      
    - id: api-tester
      agent: tester
      action: write_tests
      context_tier: 2
      requires: []
      creates:
        - services/api/tests/
      
    - id: payment-tester
      agent: tester
      action: write_tests
      context_tier: 2
      requires: []
      creates:
        - services/payment/tests/
    
    # Documentation task - runs in parallel with others
    - id: docs-generator
      agent: documenter
      action: generate_docs
      context_tier: 1
      requires: []
      creates:
        - services/api-docs/
  
    # Aggregate step - waits for all review/test/doc steps
    - id: aggregate
      agent: orchestrator
      action: aggregate_results
      context_tier: 1
      requires:
        - services/auth/review-report.json
        - services/api/review-report.json
        - services/payment/review-report.json
        - services/auth/tests/
        - services/api/tests/
        - services/payment/tests/
        - services/api-docs/
      creates:
        - aggregated-results.json
      
    - id: report
      agent: documenter
      action: generate_report
      context_tier: 1
      requires:
        - aggregated-results.json
      creates:
        - multi-agent-report.md


# Story 8.1: Progress Update System Foundation

<!-- Source: implementation/EPIC_08_Real_Time_Progress_Updates.md -->

## Status

**Ready for Review**

## Story

**As a** user running workflows,
**I want** to see formatted progress updates with clear indicators,
**so that** I understand how the workflow execution is progressing in real-time.

## Acceptance Criteria

1. Progress update message format is defined with required fields (step number, total steps, percentage, status)
2. Update generator formats status information for Cursor chat display
3. Progress calculation correctly computes current step, total steps, and percentage complete
4. Update queue system manages update frequency to prevent chat spam
5. Update format supports visual indicators (emojis, progress bars) for clarity

## Tasks / Subtasks

- [x] Task 1: Define progress update message format (AC: 1)
  - [x] Define data structure for progress updates (step, total, percentage, status, timestamp)
  - [x] Define required fields vs optional fields
  - [x] Create schema/documentation for update format
  - [x] Add validation for update message structure

- [x] Task 2: Implement update generator (AC: 2)
  - [x] Create ProgressUpdateGenerator class
  - [x] Implement format_status() method to format status for Cursor chat
  - [x] Add support for different update types (step start, step progress, step complete, error)
  - [x] Implement message templating system

- [x] Task 3: Implement progress calculation (AC: 3)
  - [x] Create ProgressCalculator class
  - [x] Implement step counting (current, total, completed, pending)
  - [x] Calculate percentage complete (completed steps / total steps)
  - [x] Handle edge cases (no steps, single step, completed workflow)

- [x] Task 4: Create update queue system (AC: 4)
  - [x] Create UpdateQueue class to manage update frequency
  - [x] Implement throttling mechanism (max updates per time period)
  - [x] Add queue prioritization (critical updates vs routine updates)
  - [x] Implement queue flushing for completion/error states

- [x] Task 5: Add visual indicator support (AC: 5)
  - [x] Define emoji mapping for status types (pending, running, completed, failed)
  - [x] Implement text-based progress bar generation
  - [x] Add formatting helpers for markdown display in Cursor chat
  - [x] Create examples of visual indicators

## Dev Notes

### Existing System Context

- Workflow execution in `tapps_agents/workflow/cursor_executor.py` - CursorWorkflowExecutor class
- Workflow state management in `tapps_agents/workflow/workflow_state.py` - WorkflowState class
- State persistence to `.tapps-agents/workflow-state/` directory
- Status files system (from Epic 7) for tracking workflow execution
- Background Agent execution with limited visibility currently

### Integration Approach

- Create new module `tapps_agents/workflow/progress_updates.py`
- ProgressUpdateGenerator will read from WorkflowState and status files
- UpdateQueue will throttle updates to Cursor chat interface
- ProgressCalculator will work with WorkflowState to compute metrics
- Format will be compatible with Cursor chat markdown rendering

### Technical Considerations

- Update format should be JSON-serializable for potential future API use
- Progress calculation must handle concurrent step execution (parallel workflows)
- Queue system needs configurable throttling parameters
- Visual indicators should be readable in both light and dark Cursor themes
- Update format extensible for future enhancement (Story 8.4, 8.5)

### Risk Assessment

- **Primary risk**: Update format may be too rigid for future needs
  - **Mitigation**: Design extensible format with version field, optional fields, backward compatibility
- **Primary risk**: Progress calculation may be inaccurate for parallel steps
  - **Mitigation**: Count running steps correctly, handle partial completion states
- **Primary risk**: Queue system may drop critical updates during throttling
  - **Mitigation**: Prioritization system, force-flush for critical events (errors, completion)

### Rollback Plan

- Progress update system is additive only
- Can disable updates via configuration flag
- No changes to existing workflow execution logic
- Can remove progress module without breaking workflows

### Testing

- Unit tests for ProgressCalculator (step counting, percentage calculation)
- Unit tests for UpdateQueue (throttling, prioritization, queue flushing)
- Unit tests for ProgressUpdateGenerator (formatting, template rendering)
- Integration tests with WorkflowState to verify progress calculation
- Test edge cases (no steps, single step, parallel steps, error states)

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-27 | 0.1     | Initial draft for Epic 8.1      | bmad-master |

## Dev Agent Record

_TBD_

## QA Results

_TBD_


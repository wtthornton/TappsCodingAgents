# Story 9.1: Natural Language Parser Foundation

<!-- Source: implementation/EPIC_09_Natural_Language_Workflow_Triggers.md -->
<!-- Context: Brownfield enhancement - Foundation for natural language workflow triggers -->

## Status

**âœ… Completed**

**Last Updated:** 2025-01-27

## Story

**As a** framework user,
**I want** a natural language parser that can extract workflow intent from conversational text,
**so that** I can trigger workflows using natural language instead of remembering exact CLI command syntax.

## Acceptance Criteria

1. Natural language parser module is created that extracts workflow intent from text input
2. Workflow name matching is implemented with support for exact matches, partial matches, and fuzzy matching
3. Workflow alias system is implemented (e.g., "rapid" = "rapid-dev", "full" = "full-sdlc", "fix" = "quick-fix")
4. Synonym matching is implemented for common workflow names (e.g., "rapid development" = "rapid-dev")
5. Intent confidence scoring is calculated and returned with parsed results (0.0 to 1.0)
6. Parser handles case-insensitive matching
7. Parser returns structured result with: intent_type, workflow_name, confidence, aliases_matched, raw_input

## Tasks / Subtasks

- [x] Task 1: Create parser module structure (AC: 1)
  - [x] Create `tapps_agents/workflow/nlp_parser.py` module
  - [x] Define `WorkflowIntent` dataclass for parsed results
  - [x] Create `NaturalLanguageParser` class with basic interface
  - [x] Add docstrings and type hints

- [x] Task 2: Implement workflow name matching (AC: 2)
  - [x] Load available workflow names from preset loader
  - [x] Implement exact match logic (case-insensitive)
  - [x] Implement partial match logic (substring matching)
  - [x] Implement fuzzy matching using string similarity (e.g., difflib or rapidfuzz)
  - [x] Return best match with confidence score

- [x] Task 3: Implement alias system (AC: 3)
  - [x] Define workflow alias mapping (rapid = rapid-dev, full = full-sdlc, etc.)
  - [x] Create alias resolution function
  - [x] Integrate alias resolution into matching logic
  - [x] Support multiple aliases per workflow

- [x] Task 4: Implement synonym matching (AC: 4)
  - [x] Define synonym dictionary for common workflow terms
  - [x] Create synonym expansion function
  - [x] Integrate synonym matching into parser
  - [x] Support multi-word synonyms (e.g., "rapid development" = "rapid-dev")

- [x] Task 5: Implement confidence scoring (AC: 5, 7)
  - [x] Calculate confidence based on match type (exact > partial > fuzzy)
  - [x] Factor in alias/synonym matches
  - [x] Return confidence score in WorkflowIntent result
  - [x] Document confidence thresholds (high > 0.8, medium > 0.5, low <= 0.5)

- [x] Task 6: Add case-insensitive support (AC: 6)
  - [x] Normalize input to lowercase for matching
  - [x] Preserve original input in result
  - [x] Test with various case combinations

## Dev Notes

### Existing System Context

- Workflow presets are loaded via `PresetLoader` in `tapps_agents/workflow/preset_loader.py`
- Workflow names are defined in workflow YAML files in `workflows/presets/` directory
- CLI commands use exact preset names: `rapid`, `full`, `fix`, `quality`, `hotfix`, `enterprise`, `feature`
- Workflow executor is in `tapps_agents/workflow/executor.py`
- Cursor Rules document workflows in `.cursor/rules/workflow-presets.mdc`

### Integration Approach

- Create new module `tapps_agents/workflow/nlp_parser.py`
- Use existing `PresetLoader` to get available workflow names
- Integrate with workflow executor for execution
- Keep parser independent of execution (separation of concerns)
- Use lightweight string matching libraries (avoid heavy NLP dependencies)

### Risk Assessment

- **Primary risk**: Fuzzy matching may produce false positives
  - **Mitigation**: Use confidence thresholds, require confirmation for low confidence matches
- **Primary risk**: Alias conflicts between workflows
  - **Mitigation**: Define canonical aliases, document conflicts, prioritize exact matches
- **Primary risk**: Performance impact of matching algorithms
  - **Mitigation**: Cache workflow names, use efficient string matching, limit fuzzy search scope

### Rollback Plan

- Parser module is additive, can be disabled without breaking existing CLI
- Keep CLI commands as primary interface
- Natural language parsing is optional enhancement

### Testing

- Unit tests for exact matching
- Unit tests for partial matching
- Unit tests for fuzzy matching
- Unit tests for alias resolution
- Unit tests for synonym expansion
- Unit tests for confidence scoring
- Integration tests with real workflow names
- Test edge cases (empty input, special characters, very long input)

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-27 | 0.1     | Initial draft for Epic 9.1      | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

- `tapps_agents/workflow/nlp_parser.py` (new)
- `tests/unit/test_nlp_parser.py` (new)

## QA Results

_TBD_


# Story 30.2: Tech Stack Config Persistence

<!-- Source: implementation/EPIC_02_Tech_Stack_Specific_Expert_Prioritization.md -->
<!-- Context: Brownfield enhancement - Persist tech stack and priorities to config file -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** detected tech stack and expert priorities to be persisted to a config file,
**so that** I can review, modify, and version control my project's expert priority configuration.

## Acceptance Criteria

1. Tech stack detection is extended to include expert priorities from mapping (Story 30.1)
2. Tech stack + priorities are persisted to `.tapps-agents/tech-stack.yaml` during `init_project()`
3. Config file includes detected frameworks with their expert priorities
4. Config file supports priority override capability (user can override default priorities)
5. Config file format is YAML and follows documented structure
6. Existing tech stack detection continues to work (backward compatible)
7. Config file is created/updated during init_project() if it doesn't exist

## Tasks / Subtasks

- [x] Task 1: Extend tech stack detection (AC: 1)
  - [x] Modify `detect_tech_stack()` to include expert priorities
  - [x] Use priority mapping from Story 30.1
  - [x] Map detected frameworks to expert priorities
  - [x] Include priorities in tech stack result

- [x] Task 2: Create config file structure (AC: 2, 5)
  - [x] Define YAML structure for tech-stack.yaml
  - [x] Include frameworks section with priorities
  - [x] Include override section for user customizations
  - [x] Document config file format

- [x] Task 3: Implement persistence (AC: 2, 7)
  - [x] Create/update `.tapps-agents/tech-stack.yaml` during init_project()
  - [x] Write detected tech stack and priorities to file
  - [x] Handle file creation if doesn't exist
  - [x] Handle file update if exists (merge or overwrite)

- [x] Task 4: Add override support (AC: 4)
  - [x] Support user-defined priority overrides in config
  - [x] Override format allows modifying default priorities
  - [x] Override takes precedence over defaults
  - [x] Document override format

- [x] Task 5: Ensure backward compatibility (AC: 6)
  - [x] Existing tech stack detection unchanged
  - [x] Priorities are additive (optional)
  - [x] Projects without priorities work normally

## Dev Notes

### Existing System Context

- Tech stack detection in `tapps_agents/core/init_project.py::detect_tech_stack()`
- Config file writing exists in init_project()
- YAML file handling already in codebase
- Project config directory is `.tapps-agents/`

### Integration Approach

- Extend `detect_tech_stack()` to call priority mapping
- Add config file writing to `init_project()` flow
- Use existing YAML writing utilities
- Follow existing config file patterns

### Risk Assessment

- **Primary risk**: Config file may overwrite user customizations
  - **Mitigation**: Merge logic, user overrides section, backup before write
- **Primary risk**: Config file format may change
  - **Mitigation**: Version config format, migration path

### Rollback Plan

- Remove priority persistence from init_project()
- Config file is optional, can be deleted
- No breaking changes

### Testing

- Unit tests for config file creation
- Unit tests for config file update
- Test override functionality
- Test backward compatibility
- Integration test with init_project()

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 30.2     | bmad-master |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5

### Debug Log References

_TBD_

### Completion Notes List

- Extended `detect_tech_stack()` to include expert_priorities when frameworks are detected
- Created `init_tech_stack_config()` function to persist tech stack and priorities to `.tapps-agents/tech-stack.yaml`
- Config file structure includes: frameworks, expert_priorities, and overrides sections
- Overrides are preserved when updating config file
- Integrated into `init_project()` flow
- All changes are backward compatible (priorities are optional)
- Comprehensive unit tests (10 tests, all passing)

### File List

- `tapps_agents/core/init_project.py` - Extended detect_tech_stack() and added init_tech_stack_config() function
- `tests/unit/core/test_tech_stack_config_persistence.py` - Unit tests for config persistence

## QA Results

_TBD_


# Story 9.3: Context-Aware Workflow Suggestions

<!-- Source: implementation/EPIC_09_Natural_Language_Workflow_Triggers.md -->
<!-- Context: Brownfield enhancement - Context-aware suggestions for workflow discovery -->

## Status

**âœ… Completed**

**Last Updated:** 2025-01-27

## Story

**As a** framework user,
**I want** the system to suggest relevant workflows based on my project context,
**so that** I can discover and use appropriate workflows without needing to know all available options.

## Acceptance Criteria

1. Suggestion system analyzes project state (recent changes, project type, branch name, file modifications)
2. Suggestion logic generates workflow recommendations based on context
3. Context factors include: recent git changes, project type detection, current branch name, modified files
4. Workflow recommendations are ranked by relevance to current context
5. Suggestions are formatted clearly for Cursor chat display
6. System provides suggestions proactively when user asks about workflows or when context changes significantly
7. Suggestions include brief explanations of why each workflow is recommended
8. System handles cases where no context is available (new project, no git history)

## Tasks / Subtasks

- [ ] Task 1: Create context analyzer module (AC: 1, 3)
  - [ ] Create `tapps_agents/workflow/context_analyzer.py` module
  - [ ] Implement git change detection (recent commits, modified files, branch name)
  - [ ] Implement project type detection (use existing project profile if available)
  - [ ] Implement file modification tracking
  - [ ] Return structured context data

- [ ] Task 2: Implement suggestion logic (AC: 2, 4)
  - [ ] Define mapping between context patterns and workflow recommendations
  - [ ] Create scoring algorithm for workflow relevance
  - [ ] Rank workflows by relevance score
  - [ ] Return top N recommendations (default: 3-5)

- [ ] Task 3: Integrate with project profile (AC: 3)
  - [ ] Use existing `ProjectProfile` from `tapps_agents/core/project_profile.py`
  - [ ] Leverage project type detection if available
  - [ ] Use tech stack information for recommendations
  - [ ] Handle cases where profile doesn't exist

- [ ] Task 4: Create suggestion formatter (AC: 5, 7)
  - [ ] Format suggestions for Cursor chat (plain text, numbered list)
  - [ ] Include workflow name, description, and relevance explanation
  - [ ] Add quick action hints (e.g., "Type: run rapid development")
  - [ ] Keep formatting concise and scannable

- [ ] Task 5: Implement proactive suggestion triggers (AC: 6)
  - [ ] Detect when user asks about workflows (keywords: "workflow", "what can I run", "suggest")
  - [ ] Detect significant context changes (new branch, major file changes)
  - [ ] Show suggestions at appropriate times (not too frequent)
  - [ ] Allow user to dismiss suggestions

- [ ] Task 6: Handle edge cases (AC: 8)
  - [ ] Handle new projects (no git history)
  - [ ] Handle projects without git
  - [ ] Provide default suggestions when context unavailable
  - [ ] Gracefully degrade when context analysis fails

## Dev Notes

### Existing System Context

- Project profile system exists in `tapps_agents/core/project_profile.py`
- Workflow recommender exists in `tapps_agents/workflow/recommender.py` (for interactive recommendations)
- Git integration may be available via standard library or gitpython
- Workflow presets are in `workflows/presets/` directory
- Cursor chat interface is where suggestions are displayed

### Integration Approach

- Create new `context_analyzer.py` module
- Reuse project profile detection if available
- Integrate with workflow recommender for consistency
- Use lightweight git analysis (avoid heavy dependencies)
- Format suggestions for Cursor chat (plain text, no markdown)

### Risk Assessment

- **Primary risk**: Context analysis may be slow or fail
  - **Mitigation**: Cache context results, handle errors gracefully, provide defaults
- **Primary risk**: Suggestions may be irrelevant or annoying
  - **Mitigation**: Use confidence thresholds, allow dismissal, learn from user feedback
- **Primary risk**: Git operations may fail in restricted environments
  - **Mitigation**: Handle permission errors, work without git, use file system analysis as fallback

### Rollback Plan

- Suggestion system is additive, can be disabled
- Workflows remain accessible via CLI and direct commands
- No breaking changes to existing functionality

### Testing

- Unit tests for context analysis (git changes, project type, file modifications)
- Unit tests for suggestion logic and scoring
- Unit tests for suggestion formatting
- Integration tests with real project contexts
- Test edge cases (no git, new project, large changes)
- Test suggestion relevance with various project states
- Performance tests for context analysis speed

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-27 | 0.1     | Initial draft for Epic 9.3      | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

- `tapps_agents/workflow/context_analyzer.py` (new)
- `tapps_agents/workflow/suggestion_engine.py` (new)
- `tests/workflow/test_context_analyzer.py` (new)
- `tests/workflow/test_suggestion_engine.py` (new)

## QA Results

_TBD_


# Story 9.2: Workflow Intent Detection

<!-- Source: implementation/EPIC_09_Natural_Language_Workflow_Triggers.md -->
<!-- Context: Brownfield enhancement - Intent detection for natural language workflow triggers -->

## Status

**âœ… Completed**

**Last Updated:** 2025-01-27

## Story

**As a** framework user,
**I want** the system to detect my intent to run workflows from natural language phrases,
**so that** I can use conversational commands like "run rapid development" or "execute full SDLC pipeline" without knowing exact syntax.

## Acceptance Criteria

1. Intent detection recognizes common action verbs ("run", "execute", "start", "trigger", "launch", "begin")
2. Workflow type detection identifies workflow categories (rapid, full, fix, quality, hotfix, enterprise, feature)
3. Parameter extraction extracts workflow name, target file, and options from natural language
4. Ambiguity detection identifies when multiple workflows match the user's intent
5. Intent detection returns structured result with: action_verb, workflow_type, parameters, ambiguity_flag, suggestions
6. System handles variations of intent phrases (e.g., "I want to run", "please execute", "can you start")
7. System extracts optional parameters like target file from phrases (e.g., "run fix on example_bug.py")

## Tasks / Subtasks

- [ ] Task 1: Implement action verb detection (AC: 1, 6)
  - [ ] Define list of action verbs and variations
  - [ ] Create verb detection function (case-insensitive, handles variations)
  - [ ] Support phrase variations ("I want to run", "please execute", "can you start")
  - [ ] Return detected verb or None if no intent detected

- [ ] Task 2: Implement workflow type detection (AC: 2)
  - [ ] Define workflow type keywords (rapid, full, fix, quality, hotfix, enterprise, feature)
  - [ ] Create type detection function that matches keywords in input
  - [ ] Support type variations ("rapid development", "full SDLC", "quick fix")
  - [ ] Return detected workflow type or None

- [ ] Task 3: Implement parameter extraction (AC: 3, 7)
  - [ ] Extract workflow name from input (using parser from Story 9.1)
  - [ ] Extract target file from phrases like "on file.py", "for example.py", "targeting bug.py"
  - [ ] Extract options/flags from natural language (e.g., "with auto mode", "skip tests")
  - [ ] Return structured parameters dictionary

- [ ] Task 4: Implement ambiguity detection (AC: 4)
  - [ ] Detect when multiple workflows match with similar confidence
  - [ ] Calculate ambiguity score (difference between top matches)
  - [ ] Flag ambiguous requests when confidence difference < threshold (e.g., 0.2)
  - [ ] Return list of candidate workflows for ambiguous cases

- [ ] Task 5: Create structured intent result (AC: 5)
  - [ ] Define `WorkflowIntentResult` dataclass
  - [ ] Include action_verb, workflow_type, parameters, ambiguity_flag, suggestions
  - [ ] Add confidence scores for each component
  - [ ] Serialize result for logging/debugging

- [ ] Task 6: Integrate with parser from Story 9.1 (AC: 1-7)
  - [ ] Use NaturalLanguageParser for workflow name matching
  - [ ] Combine intent detection with parser results
  - [ ] Return unified intent result
  - [ ] Handle cases where parser fails (fallback logic)

## Dev Notes

### Existing System Context

- Natural language parser from Story 9.1 provides workflow name matching
- Workflow presets are in `workflows/presets/` directory
- CLI commands accept parameters: `--target-file`, `--prompt`, `--auto`
- Workflow executor in `tapps_agents/workflow/executor.py` handles execution
- Cursor chat interface is where natural language input originates

### Integration Approach

- Extend `tapps_agents/workflow/nlp_parser.py` from Story 9.1
- Add intent detection methods to `NaturalLanguageParser` class
- Use regex patterns for action verb and parameter extraction
- Integrate with workflow executor for parameter passing
- Keep intent detection separate from execution (allows for confirmation step)

### Risk Assessment

- **Primary risk**: Intent detection may misinterpret user requests
  - **Mitigation**: Use confidence thresholds, require confirmation for ambiguous cases, learn from corrections
- **Primary risk**: Parameter extraction may miss or misparse file names
  - **Mitigation**: Support multiple patterns, validate extracted files exist, allow manual override
- **Primary risk**: Ambiguity detection may be too sensitive or not sensitive enough
  - **Mitigation**: Tune thresholds based on testing, allow user to override, show all candidates

### Rollback Plan

- Intent detection is additive, can be disabled
- Fall back to exact workflow name matching
- CLI commands remain primary interface

### Testing

- Unit tests for action verb detection
- Unit tests for workflow type detection
- Unit tests for parameter extraction (file names, options)
- Unit tests for ambiguity detection
- Test with various natural language inputs
- Test edge cases (no intent, multiple intents, malformed input)
- Integration tests with real workflow names
- Test parameter extraction with various file path formats

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-27 | 0.1     | Initial draft for Epic 9.2      | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

_TBD_

### File List

- `tapps_agents/workflow/nlp_parser.py` (updated from Story 9.1)
- `tests/workflow/test_intent_detection.py` (new)

## QA Results

_TBD_


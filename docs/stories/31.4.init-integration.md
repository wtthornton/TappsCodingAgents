# Story 31.4: Init Integration

<!-- Source: implementation/EPIC_03_Dynamic_Tech_Stack_Templates.md -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** tech stack templates to be automatically applied during project initialization,
**so that** I get optimal configuration without manual setup.

## Acceptance Criteria

1. Template system is integrated into `init_project()` flow
2. Template is auto-selected based on detected tech stack during init
3. Template is merged with default config during init
4. Project config is generated with template values
5. Init output shows template application (informational)
6. Init works without templates (backward compatible)

## Tasks / Subtasks

- [x] Task 1: Integrate into init (AC: 1)
  - [x] Add template selection to init_project()
  - [x] Add template merging to init_project()
  - [x] Call after tech stack detection
  - [x] Apply before config generation

- [x] Task 2: Auto-select template (AC: 2)
  - [x] Use template selection from Story 31.2
  - [x] Select based on detected stack
  - [x] Handle selection errors

- [x] Task 3: Merge during init (AC: 3)
  - [x] Use merge logic from Story 31.3
  - [x] Merge template + defaults
  - [x] Apply merged config

- [x] Task 4: Generate config (AC: 4)
  - [x] Write merged config to project config
  - [x] Include template-derived values
  - [x] Preserve user overrides

- [x] Task 5: Add output (AC: 5)
  - [x] Show template selection in init output
  - [x] Show applied template name
  - [x] Optional verbose mode

- [x] Task 6: Ensure compatibility (AC: 6)
  - [x] Test init without templates
  - [x] Test init with templates
  - [x] Verify both work

## Dev Notes

### Existing System Context

- init_project() exists
- Tech stack detection in init
- Config generation in init
- Init output formatting

### Integration Approach

- Add template steps to init flow
- Integrate with existing init steps
- Follow existing init patterns
- Maintain backward compatibility

### Risk Assessment

- **Primary risk**: Init may become slower
  - **Mitigation**: Efficient template loading, cache results

### Rollback Plan

- Remove template integration from init
- Templates optional
- No breaking changes

### Testing

- Test init with templates
- Test init without templates
- Test template selection
- Test config generation
- Integration tests

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 31.4     | bmad-master |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

N/A - No errors encountered

### Completion Notes List

- Modified `init_project_config()` to accept tech_stack parameter and apply_template flag
- Integrated template selection and merging into config initialization flow
- Template is applied after tech stack detection, before config file writing
- User config (if exists) is preserved and merged last (highest priority)
- Added template_info return value to track template application status
- Updated `init_project()` to pass tech_stack to config initialization
- Enhanced CLI output to show template application status and reason
- Backward compatible: init works without templates (graceful fallback)

### File List

- `tapps_agents/core/init_project.py` (modified)
- `tapps_agents/cli/commands/top_level.py` (modified)

## QA Results

_TBD_


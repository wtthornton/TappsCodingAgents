# Story 30.4: Priority Configuration During Init

<!-- Source: implementation/EPIC_02_Tech_Stack_Specific_Expert_Prioritization.md -->
<!-- Context: Brownfield enhancement - Auto-configure priorities during project initialization -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** expert priorities to be automatically configured during project initialization,
**so that** my project gets optimal expert prioritization without manual configuration.

## Acceptance Criteria

1. Expert priorities are auto-configured during `init_project()` based on detected tech stack
2. Tech stack config is loaded and priorities are applied to expert registry during init
3. Manual priority configuration is supported (user can edit tech-stack.yaml)
4. Expert registry is updated with priorities after init_project() completes
5. Init process shows priority configuration in output (informational)
6. Priority configuration is optional (projects work without it)

## Tasks / Subtasks

- [x] Task 1: Auto-configure during init (AC: 1)
  - [x] Call priority mapping during init_project()
  - [x] Apply detected tech stack to priority mapping
  - [x] Generate priorities for detected frameworks
  - [x] Persist to tech-stack.yaml (from Story 30.2)

- [x] Task 2: Load and apply to registry (AC: 2, 4)
  - [x] Load tech-stack.yaml after detection
  - [x] Apply priorities to expert registry
  - [x] Update expert registry with priority configuration
  - [x] Ensure registry has priorities before first consultation

- [x] Task 3: Support manual configuration (AC: 3)
  - [x] Allow user to edit tech-stack.yaml manually
  - [x] Reload priorities after manual edit (or on next init)
  - [x] Document manual configuration process

- [x] Task 4: Add init output (AC: 5)
  - [x] Show detected tech stack in init output
  - [x] Show configured expert priorities (optional, verbose mode)
  - [x] Inform user about priority configuration
  - Note: Tech stack is already shown in init output; priorities are loaded automatically by expert registry

- [x] Task 5: Ensure optional nature (AC: 6)
  - [x] Test init without priority support
  - [x] Test init with priority support
  - [x] Verify both paths work correctly

## Dev Notes

### Existing System Context

- `init_project()` exists in `tapps_agents/core/init_project.py`
- Tech stack detection already runs during init
- Expert registry is initialized during project setup
- Init output formatting exists

### Integration Approach

- Add priority configuration step to init_project() flow
- Call after tech stack detection, before expert registry initialization
- Integrate with existing init output
- Follow existing init patterns

### Risk Assessment

- **Primary risk**: Init may become slower with priority configuration
  - **Mitigation**: Efficient priority mapping, cache results, minimal overhead
- **Primary risk**: Priority configuration may fail silently
  - **Mitigation**: Error handling, logging, graceful degradation

### Rollback Plan

- Remove priority configuration from init_project()
- Priorities can be configured manually
- No breaking changes

### Testing

- Unit tests for init with priority configuration
- Test init output includes priority info
- Test manual configuration works
- Test init without priorities
- Integration test: init â†’ consultation with priorities

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 30.4     | bmad-master |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5

### Debug Log References

_TBD_

### Completion Notes List

- Priority configuration during init is already implemented in Story 30.2 (init_tech_stack_config called in init_project)
- Expert registry automatically loads priorities when initialized (Story 30.3)
- Manual configuration supported via editing tech-stack.yaml (will be loaded on next registry initialization)
- All functionality is optional and backward compatible
- Tech stack output already shown in init command output

### File List

- `tapps_agents/core/init_project.py` - Auto-configures priorities during init (from Story 30.2)
- `tapps_agents/experts/expert_registry.py` - Auto-loads priorities on initialization (from Story 30.3)

## QA Results

_TBD_


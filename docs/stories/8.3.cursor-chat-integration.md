# Story 8.3: Cursor Chat Integration

<!-- Source: implementation/EPIC_08_Real_Time_Progress_Updates.md -->

## Status

**Ready for Review**

## Story

**As a** user running workflows in Cursor,
**I want** progress updates displayed in the chat interface,
**so that** I can see workflow execution progress without switching contexts.

## Acceptance Criteria

1. Progress updates are sent to Cursor chat interface during workflow execution
2. Update messages are formatted with clear markdown and emojis for readability
3. Text-based progress bars render correctly in Cursor chat
4. Update replacement mechanism updates same message instead of spamming new messages
5. Updates are displayed in real-time without requiring manual refresh

## Tasks / Subtasks

- [x] Task 1: Create Cursor chat update mechanism (AC: 1)
  - [x] Identify Cursor chat API/interface for sending messages
  - [x] Create ChatUpdateSender class to send updates to Cursor
  - [x] Implement message sending with proper Cursor integration
  - [x] Handle Cursor chat connection/authentication if needed

- [x] Task 2: Implement markdown and emoji formatting (AC: 2)
  - [x] Format progress updates with markdown (headers, lists, code blocks)
  - [x] Add emoji indicators for status types (üîÑ running, ‚úÖ completed, ‚ùå failed, ‚è≥ pending)
  - [x] Ensure markdown renders correctly in Cursor chat
  - [x] Test formatting in both light and dark themes

- [x] Task 3: Create text-based progress bar visualization (AC: 3)
  - [x] Implement progress bar generator (e.g., `[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 80%`)
  - [x] Support different progress bar styles (full, compact, percentage only)
  - [x] Ensure progress bars display correctly in monospace context
  - [x] Add progress bar to update messages

- [x] Task 4: Implement update replacement mechanism (AC: 4)
  - [x] Track message IDs for updates that should be replaced
  - [x] Implement message update/edit functionality in Cursor chat
  - [x] Use message replacement for step progress updates
  - [x] Use new messages for workflow completion/errors (final states)

- [x] Task 5: Ensure real-time display (AC: 5)
  - [x] Verify updates appear immediately when sent
  - [x] Test with rapid status changes to ensure responsiveness
  - [x] Ensure no buffering delays in update display
  - [x] Handle connection issues gracefully (queue updates, retry)

## Dev Notes

### Existing System Context

- Cursor integration via `tapps_agents/workflow/cursor_executor.py` - CursorWorkflowExecutor
- Cursor chat interface accessible through Cursor API/SDK (to be investigated)
- Progress update system from Story 8.1 provides formatted updates
- Status monitoring from Story 8.2 provides real-time status changes
- Workflow execution happens in Cursor context with chat access

### Integration Approach

- Create new module `tapps_agents/workflow/cursor_chat.py`
- ChatUpdateSender integrates with Cursor chat API
- Connects ProgressUpdateGenerator (Story 8.1) output to Cursor chat
- Receives events from StatusMonitor (Story 8.2) to trigger updates
- Message replacement requires Cursor API support for editing messages

### Technical Considerations

- Need to investigate Cursor chat API capabilities (send, edit, delete messages)
- Message ID tracking for update replacement may require Cursor API support
- Markdown support in Cursor chat (what's supported, limitations)
- Progress bars should work in Cursor's markdown renderer (monospace font availability)
- Update frequency must balance real-time feel vs API rate limits
- If Cursor API doesn't support message editing, use message threading/grouping

### Risk Assessment

- **Primary risk**: Cursor chat API may not support message editing (update replacement)
  - **Mitigation**: Use message threading/grouping, or new messages with clear labeling, investigate API capabilities
- **Primary risk**: Update frequency may hit Cursor API rate limits
  - **Mitigation**: Respect rate limits, use throttling from Story 8.2, batch updates when possible
- **Primary risk**: Markdown rendering may differ between Cursor versions
  - **Mitigation**: Test with current Cursor version, use simple markdown, provide fallback plain text format

### Rollback Plan

- Chat integration is additive only
- Can disable via configuration flag
- Falls back to status file monitoring only if chat unavailable
- No changes to workflow execution or state management

### Testing

- Unit tests for ChatUpdateSender (message formatting, sending logic)
- Integration tests with Cursor chat (send updates, verify display)
- Test markdown rendering in Cursor (headers, lists, code, progress bars)
- Test message replacement if API supports it
- Test update frequency and rate limiting
- Test error handling (API unavailable, connection issues, rate limits)
- Manual testing in Cursor chat to verify user experience

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-27 | 0.1     | Initial draft for Epic 8.3      | bmad-master |

## Dev Agent Record

_TBD_

## QA Results

_TBD_


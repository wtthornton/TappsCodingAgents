# Story 27.4: Composite Gating Model Implementation

<!-- Source: docs/prd/epic-1-sdlc-quality-engine.md -->
<!-- Context: SDLC Quality Engine Improvements - Gating Enhancement -->

## Status

**Draft** - Partially Implemented

**Last Updated:** 2025-01-XX

**Implementation Notes:**
- QualityGate class exists (`tapps_agents/quality/quality_gates.py`) but only evaluates numeric scores
- Does NOT implement composite gate logic that evaluates:
  - Issues (critical/high/medium/low) - Missing
  - Verification outcomes (build/test/security scan failures) - Missing
  - Missing artifacts detection - Missing
- Hard fail/soft fail conditions based on issues not implemented
- Gate still score-only, not composite as required

## Story

**As a** SDLC workflow system,
**I want** gates to evaluate composite conditions (issues + verification outcomes) instead of just numeric scores,
**so that** the SDLC can make intelligent pass/fail decisions based on actual quality metrics rather than arbitrary thresholds.

## Acceptance Criteria

1. Score-only gates replaced with composite gate logic
2. Hard fail conditions implemented (critical issues, verification failures, missing artifacts)
3. Soft fail/loopback conditions implemented (high issues above threshold, regression vs baseline, low expert confidence)
4. Configurable thresholds and gate policies added
5. Gates correctly evaluate composite conditions
6. Hard fails block pipeline execution
7. Soft fails trigger loopback protocol
8. Thresholds are configurable per workflow/project

## Tasks / Subtasks

- [ ] Task 1: Design Composite Gate Model (AC: 1)
  - [ ] Define composite gate evaluation logic
  - [ ] Design gate condition structure
  - [ ] Create gate policy schema
  - [ ] Document gate decision tree

- [ ] Task 2: Implement Hard Fail Conditions (AC: 2, 6)
  - [ ] Implement critical issue detection
  - [ ] Implement verification failure detection
  - [ ] Implement missing artifact detection
  - [ ] Add hard fail blocking logic
  - [ ] Create hard fail reporting

- [ ] Task 3: Implement Soft Fail Conditions (AC: 3, 7)
  - [ ] Implement high issue threshold checking
  - [ ] Implement regression detection (vs baseline)
  - [ ] Implement expert confidence checking
  - [ ] Add soft fail loopback trigger
  - [ ] Create soft fail reporting

- [ ] Task 4: Add Configuration System (AC: 4, 8)
  - [ ] Create gate policy configuration schema
  - [ ] Implement threshold configuration
  - [ ] Add workflow-level gate overrides
  - [ ] Add project-level gate defaults
  - [ ] Create configuration validation

- [ ] Task 5: Integration & Testing (AC: 5, 6, 7, 8)
  - [ ] Integration tests with workflow executor
  - [ ] Test hard fail blocking behavior
  - [ ] Test soft fail loopback triggering
  - [ ] Test threshold configuration
  - [ ] Test gate evaluation accuracy

## Dev Notes

**Integration Points:**
- Workflow executor: `tapps_agents/workflow/executor.py`
- Issues Manifest: Story 27.1 output
- Verification system: Story 27.3 output
- Project profile: `tapps_agents/core/project_profile.py`
- Loopback protocol: Story 27.5 (dependency)

**Technology Stack:**
- Python 3.13+
- Existing workflow state management
- Configuration system (YAML-based)

**Key Constraints:**
- Must maintain backward compatibility with score-based gates (gradual migration)
- Gate evaluation must be deterministic
- Configuration must support per-workflow and per-project overrides
- Must integrate with existing checkpoint/resume system

**Testing Standards:**
- Test file location: `tests/unit/test_composite_gates.py`
- Test gate evaluation logic
- Test configuration system
- Integration tests with workflow executor

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | BMad Master |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_


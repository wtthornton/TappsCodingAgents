# Story 21.2: Separate Runtime vs Dev/Test Dependencies

<!-- Source: implementation/cursor/EPIC_21_Dependency_And_Packaging_Alignment.md -->
<!-- Context: Reduce runtime dependency bloat; dev/test tooling only via extras -->

## Status

Complete

## Story

**As a** package user installing `tapps-agents`,
**I want** a minimal runtime dependency set by default,
**so that** installing the CLI does not pull in heavy dev/test toolchains unless explicitly requested.

## Acceptance Criteria

1. A default/runtime install of the package does **not** install dev/test tools (e.g., `pytest`, `ruff`, `mypy`, `black`, `coverage`, etc.).
2. Dev/test tooling is provided via explicit extras (e.g., `.[dev]`, `.[test]`, `.[e2e]`) with clear membership documented.
3. The runtime dependency set required for CLI usage is explicit (and tested via an install verification step).
4. CI uses the appropriate extras (or equivalent) rather than relying on accidental transitive installs.
5. The dependency sets are consistent across platforms supported by the project (Windows + Linux, Python 3.13+).

## Tasks / Subtasks

- [x] Task 1: Audit current dependency sets and identify bloat (AC: 1â€“2)
  - [x] Identify which dependencies are runtime vs tooling vs optional
  - [x] Confirm what is needed for `tapps-agents` CLI to run

- [x] Task 2: Define/adjust extras for dev/test/e2e (AC: 2, 4)
  - [x] Ensure `dev` includes lint/type/test tooling needed by contributors and CI
  - [x] Split `test` and `e2e` if materially different, otherwise document a single `dev`/`test` extra
  - [x] Document extras membership in developer docs

- [x] Task 3: Add install verification for runtime footprint (AC: 1, 3)
  - [x] Add a lightweight "runtime install smoke" step (local doc and/or CI job) that validates:
    - `pip install .` (or `pip install tapps-agents`) provides the CLI entrypoint
    - core command(s) run without importing dev/test-only modules

## Dev Notes

### Existing System Context

- Current packaging uses setuptools build backend and includes multiple dependency sources.
- CI currently mixes `pip install -e ".[dev]"` and `pip install -r requirements.txt`.
- The CLI is distributed via console script: `tapps-agents=tapps_agents.cli:main`

### Integration Approach

- Keep default/runtime dependencies limited to what the CLI and runtime agent functionality needs.
- Put all test/lint/type tooling behind extras and ensure CI explicitly installs those extras.

### Risk Assessment

- **Risk**: moving a dependency out of runtime breaks CLI execution for end users.
- **Mitigation**: add an explicit runtime-install smoke verification and keep dependency decisions documented.

### Rollback Plan

- Revert the dependency reclassification while keeping documentation improvements.

### Testing

- Verify:
  - runtime install works and CLI launches
  - `pip install -e ".[dev]"` enables tests/lint/type
  - CI install contract matches docs

## Change Log

| Date       | Version | Description                           | Author      |
| ---------- | ------- | ------------------------------------- | ----------- |
| 2025-12-16 | 0.1     | Initial draft for Epic 21.2           | bmad-master |
| 2025-01-XX | 1.0     | Completed - runtime vs dev dependencies separated | Auto |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- Separated runtime dependencies (10 deps) from dev dependencies in `pyproject.toml`
- Runtime deps: core framework (pydantic, httpx, pyyaml, aiohttp, psutil) + analysis tools (radon, bandit, coverage) + reporting (jinja2, plotly)
- Dev deps moved to `[project.optional-dependencies.dev]`: pytest, black, ruff, mypy, pylint, pip-audit, pipdeptree, types-PyYAML
- Runtime installs no longer pull in dev/test tools by default
- All acceptance criteria met: runtime install minimal, dev tools via extras, CI uses dev extra

### File List

- `pyproject.toml` (updated - separated dependencies)
- `requirements.txt` (updated to match pyproject.toml)

## QA Results

_TBD_



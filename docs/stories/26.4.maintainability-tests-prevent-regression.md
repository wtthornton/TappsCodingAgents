# Story 26.4: Maintainability tests (prevent regression)

<!-- Source: implementation/cursor/EPIC_26_Core_Maintainability_Unify_Errors_And_Validation.md -->
<!-- Context: Add tests/static checks to prevent reintroducing stdlib-shadowing exceptions and duplicated validation logic -->

## Status

Draft

## Story

**As a** maintainer,  
**I want** automated checks that prevent reintroducing exception shadowing and duplicated validation logic,  
**so that** Epic 26’s maintainability and security improvements are enforced over time.

## Acceptance Criteria

1. Tests (or a static check) fail if project-defined exception classes reintroduce names that shadow Python built-ins/stdlib exceptions.
2. Tests cover centralized validation behavior for key security boundaries (traversal attempts, absolute path escapes, and expected allowed-root behavior).
3. Tests enforce that agents performing filesystem operations use the centralized validation API (or an approved wrapper), preventing drift back into ad-hoc checks.

## Tasks / Subtasks

- [ ] Task 1: Add a “no stdlib shadowing” enforcement check (AC: 1)
  - [ ] Enumerate custom exception class names from `tapps_agents/core/exceptions.py`
  - [ ] Compare against Python built-in/stdlib exception names and fail on collisions
  - [ ] Make failures actionable (clear message listing offending names)

- [ ] Task 2: Add centralized validation behavior tests (AC: 2)
  - [ ] Add unit tests for traversal and out-of-bounds access attempts
  - [ ] Add tests for Windows path normalization edge cases where relevant
  - [ ] Add tests for expected “safe paths succeed” behavior to prevent over-restriction

- [ ] Task 3: Add usage enforcement tests (AC: 3)
  - [ ] Identify a small set of representative agents that do filesystem work
  - [ ] Assert those agents call the centralized validation entry point (directly or via BaseAgent)
  - [ ] Add a lightweight guardrail (e.g., grep-based or AST-based check) to flag reintroduced bespoke traversal checks

## Dev Notes

### Existing System Context

- Epic 26 aims to reduce duplicated logic and security footguns; regressions are easy without guardrails.

### Integration Approach

- Prefer unit tests with deterministic fixtures; use AST-based checks where string matching would be too fragile.
- Keep enforcement focused and low-noise to avoid blocking unrelated PRs.

### Risk Assessment

- **Risk**: Overly strict checks create false positives and slow iteration.
- **Mitigation**: Scope checks narrowly; document escape hatches only when justified; keep messages actionable.

### Rollback Plan

- Temporarily relax the most brittle enforcement check while retaining core behavior tests.

### Testing

- Add tests under `tests/unit/` where appropriate; ensure they run quickly in CI.

## Change Log

| Date       | Version | Description                         | Author      |
| ---------- | ------- | ----------------------------------- | ----------- |
| 2025-12-16 | 0.1     | Initial draft for Epic 26.4         | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- _TBD_

### File List

- _TBD_

## QA Results

_TBD_



# Story 30.1: Tech Stack to Expert Priority Mapping

<!-- Source: implementation/EPIC_02_Tech_Stack_Specific_Expert_Prioritization.md -->
<!-- Context: Brownfield enhancement - Map detected tech stacks to expert priorities -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** detected technology stacks to automatically map to expert priorities,
**so that** the most relevant experts are prioritized for my project's technology stack, improving guidance quality and reducing token usage.

## Acceptance Criteria

1. Mapping structure is defined for frameworks → expert priorities (dictionary/map data structure)
2. Default priority mappings are defined for FastAPI stack (API Design=1.0, Observability=0.9, Performance=0.8)
3. Default priority mappings are defined for Django stack (Web Framework=1.0, Database=0.9, Security=0.8)
4. Default priority mappings are defined for React stack (Frontend=1.0, UX=0.9, State Management=0.8)
5. Default priority mappings are defined for Next.js stack (Fullstack=1.0, Frontend=0.9, Performance=0.8)
6. Default priority mappings are defined for at least one additional stack (Express, NestJS, Flask, etc.)
7. Priority mapping lookup function works correctly (takes framework name, returns priority dict)
8. Priority configuration format (YAML) is defined and documented

## Tasks / Subtasks

- [x] Task 1: Define mapping structure (AC: 1)
  - [x] Create data structure for framework → expert priorities mapping
  - [x] Define priority value format (0.0-1.0 scale)
  - [x] Document mapping structure

- [x] Task 2: Create FastAPI mapping (AC: 2)
  - [x] Define FastAPI → expert priorities
  - [x] Set API Design expert priority to 1.0
  - [x] Set Observability expert priority to 0.9
  - [x] Set Performance expert priority to 0.8
  - [x] Add other relevant experts with lower priorities

- [x] Task 3: Create Django mapping (AC: 3)
  - [x] Define Django → expert priorities
  - [x] Set Web Framework expert priority to 1.0
  - [x] Set Database expert priority to 0.9
  - [x] Set Security expert priority to 0.8

- [x] Task 4: Create React mapping (AC: 4)
  - [x] Define React → expert priorities
  - [x] Set Frontend expert priority to 1.0
  - [x] Set UX expert priority to 0.9
  - [x] Set State Management expert priority to 0.8

- [x] Task 5: Create Next.js mapping (AC: 5)
  - [x] Define Next.js → expert priorities
  - [x] Set Fullstack expert priority to 1.0
  - [x] Set Frontend expert priority to 0.9
  - [x] Set Performance expert priority to 0.8

- [x] Task 6: Create additional stack mapping (AC: 6)
  - [x] Choose additional stack (Express, NestJS, Flask, etc.)
  - [x] Define expert priorities for chosen stack
  - [x] Document priority rationale

- [x] Task 7: Implement lookup function (AC: 7)
  - [x] Create function that takes framework name
  - [x] Returns expert priority dictionary
  - [x] Handles unknown frameworks (returns empty/default priorities)
  - [x] Supports case-insensitive framework matching

- [x] Task 8: Define YAML format (AC: 8)
  - [x] Document YAML structure for priority configuration
  - [x] Create example YAML configuration
  - [x] Document how to override default priorities

## Dev Notes

### Existing System Context

- Tech stack detection exists in `tapps_agents/core/init_project.py::detect_tech_stack()`
- Expert registry exists in `tapps_agents/experts/expert_registry.py`
- Built-in experts are defined with domain matching
- Framework detection already identifies FastAPI, Django, React, Next.js, etc.

### Integration Approach

- Create mapping module in `tapps_agents/core/tech_stack_priorities.py`
- Use dictionary/map structure for framework → priorities
- Store default mappings as constants or YAML files
- Lookup function integrates with tech stack detection

### Risk Assessment

- **Primary risk**: Priority mappings may be incorrect for some projects
  - **Mitigation**: Mappings are defaults, user can override, based on common patterns
- **Primary risk**: Expert names may not match exactly
  - **Mitigation**: Use expert IDs, validate expert existence, handle missing experts

### Rollback Plan

- Remove priority mapping module
- Expert registry reverts to default behavior
- No breaking changes

### Testing

- Unit tests for mapping structure
- Unit tests for lookup function (known frameworks, unknown frameworks)
- Test priority values are in valid range (0.0-1.0)
- Test case-insensitive matching
- Integration test with tech stack detection

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 30.1     | bmad-master |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5

### Debug Log References

_TBD_

### Completion Notes List

- Created `tech_stack_priorities.py` module with FRAMEWORK_PRIORITY_MAPPINGS dictionary
- Implemented default priority mappings for FastAPI, Django, React, Next.js, and NestJS
- Created `get_priority_for_framework()` function with case-insensitive matching
- Created `get_priorities_for_frameworks()` function to combine priorities from multiple frameworks
- Added `normalize_framework_name()` helper function
- All priority values validated to be in 0.0-1.0 range
- Comprehensive unit tests (22 tests, all passing)
- YAML format documented in code comments (full documentation in Story 30.2)

### File List

- `tapps_agents/core/tech_stack_priorities.py` - Priority mapping module with framework mappings and lookup functions
- `tests/unit/core/test_tech_stack_priorities.py` - Unit tests for priority mapping functionality

## QA Results

_TBD_


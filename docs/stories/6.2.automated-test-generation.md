# Story 6.2: Automated Test Generation

<!-- Source: implementation/cursor/EPIC_06_Quality_Testing.md -->
<!-- Context: Generate unit/integration/E2E tests with framework adaptation -->

## Status

Draft

## Story

**As a** developer using the Tester agent,
**I want** automated generation of unit, integration, and (where feasible) E2E tests that match the project’s test framework and structure,
**so that** I can improve coverage and confidence without hand-writing every test.

## Acceptance Criteria

1. The Tester agent can generate **unit tests** for a target file covering:
   - happy path
   - edge cases
   - error handling
2. The Tester agent can generate **integration tests** (opt-in) for a target module/service boundary.
3. E2E test generation is supported where the project indicates an E2E harness (opt-in):
   - If no E2E framework is detected/configured, the agent degrades gracefully (documents what’s missing).
4. Test framework detection/adaptation:
   - Defaults to `pytest` for Python projects.
   - Uses configuration (`TesterAgentConfig.test_framework`, `tests_dir`) and/or project detection to decide structure and naming.
5. Tests can be generated without running, or generated + executed.
6. Unit/integration tests cover key code paths sufficiently to help reach the 80% coverage target over time (incremental on changed code).

## Tasks / Subtasks

- [ ] Task 1: Confirm and document test generation interface (AC: 1, 5)
  - [ ] Align `TesterAgent` commands (`*test`, `*generate-tests`, `*run-tests`) to cover unit vs integration vs E2E generation

- [ ] Task 2: Implement integration/E2E generation pathways (AC: 2–4)
  - [ ] Extend `tapps_agents/agents/tester/test_generator.py` to support integration and E2E generation prompts/templates
  - [ ] Add detection for common project signals (e.g., presence of `playwright`, `selenium`, `cypress`, `pytest-playwright`, etc.)
  - [ ] Ensure graceful degradation when E2E harness is missing

- [ ] Task 3: Ensure output file placement and naming is consistent (AC: 4)
  - [ ] Keep `_get_test_file_path()` mapping predictable and stable
  - [ ] Ensure generated tests do not overwrite existing tests without a safe strategy

- [ ] Task 4: Tests (AC: 1–5)
  - [ ] Extend `tests/integration/test_tester_agent.py` to cover integration generation path
  - [ ] Add unit tests for framework detection and test file path mapping

## Dev Notes

### Existing System Context

- `tapps_agents/agents/tester/agent.py::TesterAgent` already supports:
  - generating unit tests (`test_generator.generate_unit_tests`)
  - generating integration tests (`test_generator.generate_integration_tests`)
  - writing tests to disk (configurable)
  - running pytest and producing `coverage.json` via pytest-cov flags
- Coverage target is configurable via `tapps_agents/core/config.py::TesterAgentConfig.coverage_threshold` (default 80%).
- Existing tests:
  - `tests/integration/test_tester_agent.py` covers generate/run flows and basic coverage plumbing.

### Integration Approach

- Extend the test generator to cover:
  - stronger edge-case and failure-mode generation
  - optional integration/E2E templates
- Keep E2E generation strictly opt-in with clear detection and error messaging.

### Risk Assessment

- **Risk**: Generated tests are flaky or too slow.
- **Mitigation**: Prefer deterministic unit tests, isolate integration tests, and keep E2E generation opt-in.

### Rollback Plan

- Disable integration/E2E generation while keeping unit test generation and test execution intact.

### Testing

- Use `pytest`.
- Primary tests:
  - `tests/integration/test_tester_agent.py`

## Change Log

| Date       | Version | Description                | Author      |
| ---------- | ------- | -------------------------- | ----------- |
| 2025-12-14 | 0.1     | Initial draft for Epic 6.2 | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- _TBD_

### File List

- _TBD_

## QA Results

_TBD_

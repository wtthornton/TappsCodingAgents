# Story 1.5: Bounded Loopback Protocol

<!-- Source: docs/prd/epic-1-sdlc-quality-engine.md -->
<!-- Context: SDLC Quality Engine Improvements - Remediation Loop -->

## Status

**Deferred** - Duplicate of Story 27.5

## Story

**As a** SDLC workflow system,
**I want** a bounded loopback protocol that automatically remediates issues and re-validates,
**so that** the SDLC can achieve "zero issues" by iteratively fixing problems until they're resolved or escalation is required.

## Acceptance Criteria

1. Loopback policy implemented (max_attempts, retry_backoff, escalation rules)
2. Remediation payload structure created (issue → fix instructions → implementer)
3. Deterministic re-validation after remediation implemented
4. Integration with existing checkpoint/resume system
5. Issue history persistence implemented
6. Loopback triggers on soft fails
7. Remediation payloads correctly formatted
8. Re-validation runs after fixes
9. Max attempts respected
10. Escalation produces blockers report

## Tasks / Subtasks

- [ ] Task 1: Design Loopback Policy (AC: 1)
  - [ ] Define loopback policy schema
  - [ ] Design max_attempts logic
  - [ ] Design retry_backoff strategy
  - [ ] Design escalation rules
  - [ ] Document loopback policy specification

- [ ] Task 2: Implement Remediation Payload (AC: 2, 7)
  - [ ] Create remediation payload structure
  - [ ] Map issues to fix instructions
  - [ ] Create implementer routing logic
  - [ ] Add payload validation
  - [ ] Create payload serialization

- [ ] Task 3: Implement Loopback Execution (AC: 3, 6, 8)
  - [ ] Create loopback orchestrator
  - [ ] Implement soft fail detection and trigger
  - [ ] Implement remediation execution
  - [ ] Implement re-validation after fixes
  - [ ] Add loopback state tracking

- [ ] Task 4: Integrate with Checkpoint/Resume (AC: 4)
  - [ ] Integrate loopback state with checkpoint system
  - [ ] Add loopback state to workflow state
  - [ ] Implement loopback resume logic
  - [ ] Test checkpoint/resume with loopback

- [ ] Task 5: Implement Issue History (AC: 5)
  - [ ] Create issue history storage
  - [ ] Implement issue tracking across loopback attempts
  - [ ] Add issue resolution tracking
  - [ ] Create issue history query utilities

- [ ] Task 6: Implement Escalation (AC: 1, 9, 10)
  - [ ] Implement max_attempts enforcement
  - [ ] Create escalation trigger logic
  - [ ] Generate blockers report
  - [ ] Add escalation notification
  - [ ] Create escalation metadata

- [ ] Task 7: Testing & Validation (AC: 6, 7, 8, 9, 10)
  - [ ] Unit tests for loopback orchestrator
  - [ ] Integration tests with workflow executor
  - [ ] Test remediation payload generation
  - [ ] Test re-validation logic
  - [ ] Test escalation behavior
  - [ ] Test issue history tracking

## Dev Notes

**Integration Points:**
- Composite gates: Story 1.4 output
- Issues Manifest: Story 1.1 output
- Verification system: Story 1.3 output
- Checkpoint/resume: `tapps_agents/workflow/executor.py`
- Workflow state: Existing workflow state management

**Technology Stack:**
- Python 3.13+
- Existing checkpoint/resume infrastructure
- State persistence system

**Key Constraints:**
- Loopback must be bounded to prevent infinite loops
- Remediation must be deterministic and reproducible
- Must integrate seamlessly with existing checkpoint/resume
- Issue history must be efficient and queryable

**Testing Standards:**
- Test file location: `tests/unit/test_loopback.py`
- Test loopback execution flow
- Test remediation payload generation
- Test escalation behavior
- Integration tests with full workflow

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | BMad Master |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_


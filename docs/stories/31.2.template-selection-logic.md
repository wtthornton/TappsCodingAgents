# Story 31.2: Template Selection Logic

<!-- Source: implementation/EPIC_03_Dynamic_Tech_Stack_Templates.md -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** the system to automatically select the appropriate tech stack template based on detected frameworks,
**so that** I get the right configuration without manual template selection.

## Acceptance Criteria

1. Template selection function maps detected frameworks to template files
2. Selection works for FastAPI projects (selects fastapi.yaml)
3. Selection works for Next.js projects (selects nextjs.yaml)
4. Multiple framework detection is handled (selects best match or merges templates)
5. Fallback to default template works when no match is found
6. Template selection logic is documented

## Tasks / Subtasks

- [x] Task 1: Implement mapping (AC: 1)
  - [x] Create framework → template file mapping
  - [x] Map FastAPI → fastapi.yaml
  - [x] Map Next.js → nextjs.yaml
  - [x] Support additional frameworks

- [x] Task 2: Handle single framework (AC: 2, 3)
  - [x] Select template for FastAPI
  - [x] Select template for Next.js
  - [x] Verify template file exists

- [x] Task 3: Handle multiple frameworks (AC: 4)
  - [x] Detect multiple frameworks
  - [x] Select best match (priority order)
  - [x] Or merge multiple templates
  - [x] Document selection strategy

- [x] Task 4: Implement fallback (AC: 5)
  - [x] Fallback to default template
  - [x] Handle missing template files
  - [x] Log selection decision

- [x] Task 5: Document logic (AC: 6)
  - [x] Document selection algorithm
  - [x] Document priority order
  - [x] Document fallback behavior

## Dev Notes

### Existing System Context

- Tech stack detection exists
- Template files from Story 31.1
- Framework detection identifies multiple frameworks

### Integration Approach

- Create template selector module
- Use tech stack detection results
- Map to template files
- Follow existing selection patterns

### Risk Assessment

- **Primary risk**: Wrong template selected
  - **Mitigation**: Clear mapping rules, user can override, fallback to default

### Rollback Plan

- Remove template selection
- Manual template selection
- No breaking changes

### Testing

- Test template selection for each framework
- Test multiple framework handling
- Test fallback behavior
- Test missing template files

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 31.2     | bmad-master |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5

### Debug Log References

N/A - No errors encountered

### Completion Notes List

- Created `tapps_agents/core/template_selector.py` module with template selection logic
- Implemented framework-to-template mapping with support for 10+ frameworks
- Implemented single framework selection with direct mapping
- Implemented multi-framework selection with priority-based ordering (Next.js > NestJS > FastAPI > Django > Express > Flask > React > Vue > Angular)
- Implemented fallback handling for missing templates and unmapped frameworks
- Added comprehensive docstrings and type hints
- Selection logic handles edge cases (case-insensitive matching, partial matches, missing files)

### File List

- `tapps_agents/core/template_selector.py` (new)

## QA Results

_TBD_


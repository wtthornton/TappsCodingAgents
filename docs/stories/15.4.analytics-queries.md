# Story 15.4: Analytics Queries and Natural Language

<!-- Source: implementation/EPIC_15_Analytics_Dashboard_Integration.md -->

## Status

**âœ… Completed**

## Story

**As a** user wanting to query analytics,
**I want** to ask questions in natural language,
**so that** I can get specific metrics without knowing exact commands.

## Acceptance Criteria

1. Natural language analytics queries are parsed correctly
2. Query parser understands common question patterns
3. Query execution fetches and formats results appropriately
4. Query suggestions help users ask better questions
5. Results are formatted clearly for Cursor chat

## Tasks / Subtasks

- [x] Task 1: Implement natural language query parsing (AC: 1)
  - [x] Create AnalyticsQueryParser class
  - [x] Parse common question patterns ("how many", "what is", "show me")
  - [x] Extract metric type from query (agents, workflows, system)
  - [x] Extract filters from query (time range, agent name, etc.)

- [x] Task 2: Create query parser (AC: 2)
  - [x] Support agent performance questions
  - [x] Support workflow performance questions
  - [x] Support system status questions
  - [x] Support trend questions
  - [x] Handle ambiguous queries gracefully

- [x] Task 3: Implement query execution (AC: 3)
  - [x] Map parsed queries to data access methods
  - [x] Execute queries with appropriate filters
  - [x] Format results for display
  - [x] Handle query errors gracefully

- [x] Task 4: Add query suggestions (AC: 4)
  - [x] Suggest common queries when no match found
  - [x] Provide query examples
  - [x] Suggest related queries
  - [x] Help users refine ambiguous queries

- [x] Task 5: Format query results (AC: 5)
  - [x] Format results as tables or lists
  - [x] Add context to results (time range, filters applied)
  - [x] Use visualizations for trend queries
  - [x] Make results easy to read

## Dev Notes

### Existing System Context

- NLP parser exists for workflow triggers (Epic 9)
- NaturalLanguageParser can be extended for analytics
- Analytics data accessor provides query methods

### Integration Approach

- Create `tapps_agents/workflow/analytics_query_parser.py`
- Extend or reuse NLP patterns from Epic 9
- Integrate with analytics data accessor
- Support both natural language and structured queries

### Technical Considerations

- Query parsing should be fast (no LLM calls)
- Support common patterns with regex/keyword matching
- Fallback to structured query format if parsing fails
- Cache common query patterns for performance


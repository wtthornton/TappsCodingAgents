# Story 14.4: Clear Error Messages

<!-- Source: implementation/cursor/EPIC_14_E2E_Test_Reliability.md -->
<!-- Context: Enhance error messages throughout E2E suite to be specific, actionable, and include context for debugging -->

## Status

**Deferred** - Testing infrastructure improvement, lower priority

## Story

**As a** QA engineer and developer,
**I want** clear, actionable error messages throughout the E2E test suite that include context and suggestions for fixing issues,
**so that** test failures are immediately debuggable and I can quickly identify and fix what went wrong.

## Acceptance Criteria

1. Error messages throughout E2E suite include context:
   - Test name, scenario type, workflow ID
   - Current step or operation being tested
   - Relevant state information (if applicable)
2. Error messages include expected vs actual values:
   - Expected artifact location vs actual location checked
   - Expected file path vs actual file existence
   - Expected test outcome vs actual outcome
3. Error messages include suggestions for fixing issues:
   - What action to take (create file, fix path, update dependency)
   - What setup is required (ensure workflow exists, ensure template exists)
   - Links to relevant documentation (if applicable)
4. Error message utilities created in `tests/e2e/fixtures/error_helpers.py`:
   - Standardized error message formatting functions
   - Context builder functions
   - Error message templates
5. Error message format standardized across E2E suite:
   - Consistent structure and formatting
   - Consistent use of context, expected/actual, suggestions
   - Consistent use of stack traces for debugging
6. Stack traces included in error messages for debugging (preserved from exceptions)
7. Unit tests exist for error message utilities

## Tasks / Subtasks

- [ ] Task 1: Create error message utilities (AC: 4)
  - [ ] Create `tests/e2e/fixtures/error_helpers.py` module
  - [ ] Implement `format_validation_error()` function for validation errors
  - [ ] Implement `format_dependency_error()` function for missing dependencies
  - [ ] Implement `format_execution_error()` function for execution failures
  - [ ] Implement `build_error_context()` function to gather context

- [ ] Task 2: Implement context gathering (AC: 1)
  - [ ] Function to extract test context (test name, scenario type, workflow ID)
  - [ ] Function to extract step context (current step, operation)
  - [ ] Function to extract state context (workflow state, artifacts)
  - [ ] Integrate context into error messages

- [ ] Task 3: Implement expected vs actual formatting (AC: 2)
  - [ ] Function to format expected vs actual comparisons
  - [ ] Format artifact location comparisons
  - [ ] Format file path comparisons
  - [ ] Format test outcome comparisons

- [ ] Task 4: Implement suggestion generation (AC: 3)
  - [ ] Function to generate fix suggestions based on error type
  - [ ] Suggestions for missing files (create file, check path)
  - [ ] Suggestions for missing dependencies (setup instructions)
  - [ ] Suggestions for validation failures (expected vs actual)

- [ ] Task 5: Update scenario validator error messages (AC: 5)
  - [ ] Use error helpers in `scenario_validator.py`
  - [ ] Include context in artifact validation errors
  - [ ] Include expected vs actual in file validation errors
  - [ ] Include suggestions in all validation errors

- [ ] Task 6: Update dependency validator error messages (AC: 5)
  - [ ] Use error helpers in `dependency_validator.py` (from Story 14.2)
  - [ ] Include context in dependency validation errors
  - [ ] Include expected paths in missing dependency errors
  - [ ] Include suggestions in all dependency errors

- [ ] Task 7: Update workflow runner error messages (AC: 5)
  - [ ] Use error helpers in `workflow_runner.py`
  - [ ] Include context in workflow execution errors
  - [ ] Include step context in step execution errors
  - [ ] Preserve stack traces in error messages

- [ ] Task 8: Standardize error message format (AC: 5, 6)
  - [ ] Define error message format standard
  - [ ] Apply format across all error messages
  - [ ] Include stack traces in error messages
  - [ ] Document error message format in E2E test documentation

- [ ] Task 9: Create unit tests (AC: 7)
  - [ ] Create `tests/unit/e2e/test_error_helpers.py`
  - [ ] Test error message formatting functions
  - [ ] Test context gathering functions
  - [ ] Test expected vs actual formatting
  - [ ] Test suggestion generation

## Dev Notes

### Existing System Context

- Current error messages may be minimal or lack context:
  - `"Expected planning artifact not found: {artifact}"` (no path, no suggestion)
  - `"Workflow file not found: {workflow_path}"` (no suggestion)
  - Exception messages may not include test context
- Error locations:
  - `tests/e2e/fixtures/scenario_validator.py` - validation errors
  - `tests/e2e/fixtures/workflow_runner.py` - execution errors
  - `tests/e2e/scenarios/test_*.py` - test failures
  - `tests/e2e/workflows/test_*.py` - workflow test failures
- Integration points:
  - Error helpers will be used across all E2E fixtures
  - Error helpers will be used in validators
  - Error helpers will be used in workflow runner

### Integration Approach

- Create new `error_helpers.py` module with reusable error formatting functions
- Integrate error helpers into existing validators and runners
- Update error messages throughout E2E suite to use error helpers
- Standardize error message format across all error types
- Preserve stack traces from exceptions

### Technology Research

- Use `traceback.format_exc()` or `traceback.format_exception()` for stack traces
- Use `inspect` module for gathering context (test name, function name)
- Use f-strings for error message formatting
- Use exception chaining to preserve original exceptions

### Risk Assessment

- **Primary risk**: Error messages may become too verbose or cluttered
- **Mitigation**: Focus on actionable information, use consistent formatting, make messages scannable
- **Secondary risk**: Context gathering may add overhead to error handling
- **Mitigation**: Context gathering should be lightweight, only gather necessary context

### Testing

- Test file location: `tests/unit/e2e/test_error_helpers.py`
- Test standards: Use `pytest`, follow existing unit test patterns
- Testing frameworks: `pytest`
- Specific requirements:
  - Test error message formatting functions produce correct format
  - Test context gathering functions extract correct context
  - Test expected vs actual formatting is clear
  - Test suggestions are actionable and relevant
  - Test stack traces are preserved in error messages

## Change Log

| Date       | Version | Description                       | Author      |
| ---------- | ------- | --------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 14.4       | bmad-master |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_


# Story 24.2: Define a Filesystem Access Policy for Agents

<!-- Source: implementation/cursor/EPIC_24_Security_Policy_Reality_And_Path_Enforcement.md -->
<!-- Context: Establish clear, documented read/write boundaries for agent filesystem operations -->

## Status

Draft

## Story

**As a** maintainer and security reviewer,  
**I want** a clear filesystem access policy for agents,  
**so that** path safety rules are explicit, consistent across agents, and enforceable in code and tests.

## Acceptance Criteria

1. A written policy defines **allowed roots** for agent filesystem operations (minimum: project/workspace root + `.tapps-agents/`).
2. The policy defines expected handling for:
   - temporary/test paths
   - worktrees/state/artifacts under `.tapps-agents/`
   - reads vs writes (if rules differ)
3. The policy is documented in a developer-facing location and referenced from relevant docs (at minimum `SECURITY.md` or `docs/ARCHITECTURE.md` / `docs/CONFIGURATION.md`, whichever is appropriate in-repo).
4. The policy explicitly states whether any **escape hatch** exists; if it exists, it is explicit, opt-in, and documented (no implicit bypass).

## Tasks / Subtasks

- [ ] Task 1: Inventory current filesystem behaviors and implied policy (AC: 1–2)
  - [ ] Review `tapps_agents/core/agent_base.py` path validation and file ops entry points
  - [ ] Review agent-specific path checks in `tapps_agents/agents/*`
  - [ ] Identify the canonical roots currently used (workspace root, `.tapps-agents/`, etc.)

- [ ] Task 2: Write the filesystem access policy (AC: 1–4)
  - [ ] Define allowed roots and normalization requirements (e.g., resolve to absolute path before checks)
  - [ ] Define read/write rules and any exceptions
  - [ ] Define how tests may use temp directories (and how those are configured/allowed)
  - [ ] Document any explicit escape hatch, if needed, and how it is enabled

- [ ] Task 3: Integrate policy into documentation set (AC: 3)
  - [ ] Add references from `SECURITY.md` and relevant developer docs
  - [ ] Ensure terms match implementation naming (e.g., “allowed roots”, “workspace root”, “state dir”)

## Dev Notes

### Existing System Context

- Path validation exists in `tapps_agents/core/agent_base.py` and in some agent-specific logic.
- Worktrees/state/artifacts live under `.tapps-agents/`.

### Integration Approach

- Treat the policy as the single source of truth for what enforcement must implement (Story 24.3).
- Keep policy minimal but testable, prioritizing least privilege and clear error messaging.

### Risk Assessment

- **Risk**: A policy that is too vague won’t be enforceable; too strict could break workflows.
- **Mitigation**: Define concrete roots and clearly separate “normal usage” from “test-only” scenarios.

### Rollback Plan

- Documentation-only change: adjust policy wording if enforcement proves too strict in implementation.

### Testing

- Policy validation will be realized via Story 24.4 regression tests.

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-12-16 | 0.1     | Initial draft for Epic 24.2     | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- _TBD_

### File List

- _TBD_

## QA Results

_TBD_



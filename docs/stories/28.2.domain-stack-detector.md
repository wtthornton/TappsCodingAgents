# Story 28.2: Domain/Stack Detector

<!-- Source: docs/prd/epic-2-dynamic-expert-rag-engine.md -->
<!-- Context: Dynamic Expert & RAG Engine - Detection Foundation -->

## Status

**In Progress** - Core Implementation Complete

**Last Updated:** 2025-01-XX

**Implementation Notes:**
- Domain/Stack Detector implemented (`tapps_agents/experts/domain_detector.py`)
- Dependency manifest detection implemented (requirements.txt, package.json, pyproject.toml)
- Config file detection implemented (Dockerfile, k8s, .env)
- Build tooling detection implemented (Makefile, webpack, vite)
- Service boundary detection implemented (api/, services/)
- File structure detection implemented (file extensions, directory patterns)
- CI workflow detection implemented (GitHub Actions, GitLab CI)
- Domain mapping logic implemented (signal → domain mapping with confidence)
- Basic tests created (`tests/unit/test_domain_detector.py`)
- Integration with project profile ready (can be enhanced)

## Story

**As a** Expert Engine,
**I want** a domain/stack detector that automatically maps repo signals to expert domains,
**so that** the Expert Engine can identify which technical domains are relevant for the current project without manual configuration.

## Acceptance Criteria

1. Detector implemented that maps repo signals to expert domains
2. Detection for dependency manifests implemented
3. Detection for config files implemented
4. Detection for build tooling implemented
5. Detection for service boundaries implemented
6. Detection for file extensions and directory structure implemented
7. Detection for CI workflow files implemented
8. Domain mapping logic created (repo signals → technical domains)
9. Integration with project profile system
10. Detector correctly identifies project stack
11. Detector maps to appropriate domains
12. Detector integrates with project profile

## Tasks / Subtasks

- [ ] Task 1: Design Domain Detector Architecture (AC: 1)
  - [ ] Define detector interface and responsibilities
  - [ ] Design signal collection mechanism
  - [ ] Design domain mapping algorithm
  - [ ] Document detector architecture

- [ ] Task 2: Implement Dependency Manifest Detection (AC: 2)
  - [ ] Detect package.json, pyproject.toml, requirements.txt, etc.
  - [ ] Parse dependency information
  - [ ] Extract framework/library signals
  - [ ] Map dependencies to technical domains

- [ ] Task 3: Implement Config File Detection (AC: 3)
  - [ ] Detect common config files (.env, config.yaml, etc.)
  - [ ] Parse configuration patterns
  - [ ] Extract stack indicators from config
  - [ ] Map config patterns to domains

- [ ] Task 4: Implement Build Tooling Detection (AC: 4)
  - [ ] Detect build files (Makefile, Dockerfile, etc.)
  - [ ] Detect build tool configs (webpack, vite, etc.)
  - [ ] Extract build tool signals
  - [ ] Map build tools to domains

- [ ] Task 5: Implement Service Boundary Detection (AC: 5)
  - [ ] Detect microservice patterns
  - [ ] Detect API boundaries
  - [ ] Detect service configuration
  - [ ] Map service patterns to domains

- [ ] Task 6: Implement File/Directory Structure Detection (AC: 6)
  - [ ] Analyze file extensions
  - [ ] Analyze directory structure patterns
  - [ ] Extract language/framework signals
  - [ ] Map structure patterns to domains

- [ ] Task 7: Implement CI Workflow Detection (AC: 7)
  - [ ] Detect GitHub Actions, GitLab CI, etc.
  - [ ] Parse CI workflow patterns
  - [ ] Extract CI tool signals
  - [ ] Map CI patterns to domains

- [ ] Task 8: Implement Domain Mapping Logic (AC: 8, 10, 11)
  - [ ] Create signal aggregation algorithm
  - [ ] Implement domain scoring/ranking
  - [ ] Create domain mapping rules
  - [ ] Add domain confidence scoring

- [ ] Task 9: Integrate with Project Profile (AC: 9, 12)
  - [ ] Integrate with project profile system
  - [ ] Store detection results in project profile
  - [ ] Use project profile for detection hints
  - [ ] Update project profile with detected domains

- [ ] Task 10: Testing & Validation (AC: 10, 11, 12)
  - [ ] Unit tests for each detection type
  - [ ] Integration tests with project profile
  - [ ] Test detection accuracy with real projects
  - [ ] Test domain mapping correctness

## Dev Notes

**Integration Points:**
- Project profile: `tapps_agents/core/project_profile.py`
- Project profile file: `.tapps-agents/project-profile.yaml`
- Expert Engine: Story 28.1 output (dependency)
- Expert registry: `tapps_agents/experts/expert_registry.py`

**Technology Stack:**
- Python 3.13+
- Existing project profiling infrastructure
- File system analysis libraries
- YAML/JSON parsing

**Key Constraints:**
- Detection must be fast and non-intrusive
- Must work with various project structures
- Domain mapping must be accurate and extensible
- Must integrate seamlessly with project profile

**Testing Standards:**
- Test file location: `tests/unit/test_domain_detector.py`
- Test with multiple project types
- Validate detection accuracy
- Test domain mapping correctness

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial story creation | BMad Master |
| 2025-01-XX | 1.1 | Core implementation complete - Domain/Stack Detector with signal collection and domain mapping | BMad Master |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_


# Story 7.1: Comprehensive Documentation Generation

<!-- Source: implementation/cursor/EPIC_07_Documentation_Polish.md -->
<!-- Context: Generate complete API docs + guides + workflow docs using the Documenter agent -->

## Status

Draft

## Story

**As a** maintainer,
**I want** a consistent, automated documentation generation workflow (API reference + guides + workflow docs),
**so that** the system stays production-ready and changes don’t silently rot the docs.

## Acceptance Criteria

1. The Documenter agent can generate **project-level** API documentation (not just single-file) for the `tapps_agents/` package, including all workflow agents and key workflow engine modules.
2. Documentation output is deterministic and organized:
   - written under a dedicated output directory (e.g., `docs/api/` or `docs/generated/`)
   - includes an index (table of contents) that links to per-module/per-agent pages
   - uses stable filenames suitable for git diffs
3. Generated documentation includes **at minimum**:
   - agent command lists and usage examples (CLI + Python API lifecycle)
   - workflow engine overview and state/artifacts locations
   - configuration entry points (where defaults come from; where `.tapps-agents/config.yaml` is read)
4. Documentation generation is safe and predictable:
   - respects path validation rules (no traversal, no writes outside intended docs folder)
   - does not write secrets or environment variable values into output
5. The workflow engine can invoke the Documenter agent for “docs” steps in a predictable way (headless execution), and the resulting docs directory is captured as a workflow artifact when configured.
6. Tests cover the project-level generation path and ensure output files are created where expected.

## Tasks / Subtasks

- [ ] Task 1: Define project-level docs generation contract (AC: 1, 2)
  - [ ] Decide whether to extend `DocumenterAgent.generate_docs_command()` to accept `file=None` (project mode) or add a new command (e.g., `generate-project-docs`)
  - [ ] Define output root (`docs/api/` vs `docs/generated/`) and index format

- [ ] Task 2: Implement project-level API docs generation (AC: 1, 2, 3)
  - [ ] Enumerate target modules (agents + workflow engine entrypoints) and generate per-module docs
  - [ ] Generate an index page that links to outputs

- [ ] Task 3: Integrate with workflow “documenter” steps (AC: 5)
  - [ ] Align `tapps_agents/workflow/executor.py` documenter mapping parameters with the Documenter agent’s real signature
  - [ ] Ensure `creates: ["docs/"]` captures the generated docs directory as an artifact

- [ ] Task 4: Safety + hygiene checks (AC: 4)
  - [ ] Ensure path allowlisting is enforced via the agent base path validation
  - [ ] Ensure outputs never include secrets / raw API key values

- [ ] Task 5: Tests (AC: 6)
  - [ ] Add/extend unit tests for project-level generation in `tests/unit/test_doc_generator.py`
  - [ ] Add/extend integration tests in `tests/integration/test_documenter_agent.py` to validate directory outputs

## Dev Notes

### Existing System Context

- Documenter agent exists and is already wired into CLI and workflow execution:
  - `tapps_agents/agents/documenter/agent.py` exposes `*document`, `*generate-docs`, `*update-readme`, `*update-docstrings`.
  - `tapps_agents/agents/documenter/doc_generator.py` generates content using MAL and basic AST structure analysis.
  - CLI routes `documenter generate-docs` via `_handle_documenter_command()` in `tapps_agents/cli.py`.
  - Workflow executor maps `agent=documenter` steps and stores `documenter_result` in state: `tapps_agents/workflow/executor.py`.
- Foundational docs already exist under `docs/`:
  - `docs/API.md`, `docs/ARCHITECTURE.md`, `docs/DEPLOYMENT.md`, `docs/TROUBLESHOOTING.md`.

### Integration Approach

- Extend the Documenter agent to support a **project-level** generation mode that:
  - scans `tapps_agents/` for key modules (agents + workflow engine)
  - writes deterministic outputs under a dedicated docs subdirectory
  - produces an index linking all generated pages
- Keep docs generation compatible with workflow orchestration by ensuring the workflow executor passes parameters that match the agent’s signature.

### Risk Assessment

- **Risk**: Large repos generate huge prompts/outputs.
- **Mitigation**: Limit per-module prompt size (already truncates code to 5000 chars), generate docs in smaller module chunks, and/or skip private/test modules.

### Rollback Plan

- Keep existing single-file `*document` / `*generate-docs file=...` behavior unchanged; project-level generation can be a new command or an optional `file=None` path.

### Testing

- Existing tests already cover DocGenerator and Documenter agent basics:
  - `tests/unit/test_doc_generator.py`
  - `tests/integration/test_documenter_agent.py`
- Add tests for project-level output directory creation + index generation.

## Change Log

| Date       | Version | Description                                 | Author      |
| ---------- | ------- | ------------------------------------------- | ----------- |
| 2025-12-15 | 0.1     | Initial draft for Epic 7.1                  | bmad-master |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- _TBD_

### File List

- _TBD_

## QA Results

_TBD_

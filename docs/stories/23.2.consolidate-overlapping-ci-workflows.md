# Story 23.2: Consolidate overlapping CI workflows

<!-- Source: implementation/cursor/EPIC_23_CI_Gating_And_Workflow_Consolidation.md -->
<!-- Context: Remove duplication/drift between CI workflows and standardize install/test commands -->

```yaml
story_id: 23.2
title: Consolidate overlapping CI workflows
description: Reduce redundant CI workflows (e.g., duplicate unit test pipelines) by defining a single canonical workflow or clearly separating responsibilities, with consistent install + test commands.
epic: EPIC_23_CI_Gating_And_Workflow_Consolidation
domain: CI/CD
priority: high
complexity: 4
status: draft
created_at: 2025-12-16
created_by: planner
```

## Acceptance Criteria

- [ ] Only one canonical unit-test workflow remains **or** responsibilities are clearly separated and documented (no duplication or drift).
- [ ] All CI workflows use a consistent install strategy (aligned with Epic 21 policy).
- [ ] Developer documentation references the canonical workflow(s) and explains what runs on PR vs main vs scheduled.
- [ ] PR checks remain fast; deep/slow suites are moved to scheduled/manual workflows.

## Tasks

1. Inventory current CI workflows and execution entrypoints
   - Identify whether CI is currently driven by GitHub Actions (`.github/workflows/*.yml`) and/or by the project’s internal workflow system (`workflows/*.yaml`).
   - Enumerate which workflows are meant to gate PRs and which are informational or scheduled.

2. Define the canonical CI workflow responsibilities
   - Decide the “one canonical unit test” workflow (name + path) and what it owns: lint/type/unit (+ optional fast e2e smoke).
   - Define scheduled/manual workflows for slower suites (e2e scenario / real-service).

3. Standardize install and test commands across workflows
   - Choose the standard Python setup and dependency install mechanism.
   - Ensure the same command set is used consistently across PR/main/scheduled workflows.

4. Remove or refactor redundant workflows
   - Delete duplicates or refactor them into reusable workflows/steps where appropriate.
   - Ensure required checks reference the canonical job(s) that cannot go “false green.”

5. Update documentation
   - Update developer docs to point contributors at the canonical workflow(s) and local equivalents.

## Technical Notes

- EPIC_23 calls out drift between `.github/workflows/ci.yml` and `.github/workflows/test.yml`; if these do not exist yet, the consolidation step becomes “introduce canonical workflow and avoid introducing duplicates.”
- Keep PR workflows secret-free and fork-compatible (Epic compatibility requirement).
- If using `workflows/*.yaml` (project orchestration), ensure any PR gating in GitHub still maps to enforceable checks.

## Dependencies

- Related stories: ["23.1", "23.3", "23.4", "21.1"]
- Blocks: ["23.3", "23.4"]
- Blocked by: ["23.1"]



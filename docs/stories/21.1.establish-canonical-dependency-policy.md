# Story 21.1: Establish Canonical Dependency Policy

<!-- Source: implementation/cursor/EPIC_21_Dependency_And_Packaging_Alignment.md -->
<!-- Context: Brownfield packaging/dependency alignment (single source of truth = pyproject.toml) -->

## Status

Complete

## Story

**As a** maintainer and contributor,
**I want** a clear, enforced dependency policy with a single authoritative source,
**so that** local installs and CI use the same contract and dependency drift cannot silently creep in.

## Acceptance Criteria

1. `pyproject.toml` is explicitly documented as the authoritative source of truth for package metadata and dependencies.
2. The project defines (and documents) what each dependency channel means:
   - runtime/default install
   - `dev` extras (lint/type/test tooling)
   - `test` and/or `e2e` extras (if distinct)
3. The policy states the intended role of `requirements.txt`:
   - either removed, or
   - retained strictly as a generated/CI convenience artifact (non-authoritative), with generation guidance.
4. The policy documents what belongs in runtime dependencies vs dev/test tooling (explicitly calls out tools like `pytest`, `ruff`, `mypy`, `black` as **not** runtime deps).
5. Developer documentation includes a minimal “install matrix” that enumerates the supported install commands:
   - runtime install
   - editable/dev install
   - CI/test install
   - e2e install (if applicable)

## Tasks / Subtasks

- [x] Task 1: Audit current dependency sources and install paths (AC: 1–3)
  - [x] Review `pyproject.toml` dependency metadata and extras
  - [x] Review `setup.py`, `requirements.txt`, and `MANIFEST.in` for overlapping or conflicting dependency declarations
  - [x] Review GitHub Actions workflows install steps (`.github/workflows/*.yml`)

- [x] Task 2: Write canonical dependency policy documentation (AC: 1–5)
  - [x] Add/update `docs/DEVELOPER_GUIDE.md` with "single source of truth" and install matrix
  - [x] Add/update `CONTRIBUTING.md` with the standard install commands and intended extras
  - [x] Created `docs/DEPENDENCY_POLICY.md` with comprehensive policy documentation

- [x] Task 3: Add a lightweight enforcement mechanism reference (AC: 1–3)
  - [x] Define how drift is detected (script, CI check, or removing alternate sources)
  - [x] Ensure policy is actionable (contributors know what to edit and what not to edit)

## Dev Notes

### Existing System Context

- Packaging + dependency declarations currently exist across:
  - `pyproject.toml` (intended authoritative)
  - `setup.py`
  - `requirements.txt`
  - `MANIFEST.in`
- CI currently installs dependencies using a mix of editable installs and requirements files.
- CLI entrypoint must remain: `tapps-agents=tapps_agents.cli:main`

### Integration Approach

- Treat `pyproject.toml` as the single source of truth for dependency intent.
- Make other files either:
  - derived/generated from `pyproject.toml`, or
  - minimal stubs that do not redefine dependency sets.

### Risk Assessment

- **Primary risk**: contributors continuing to update `requirements.txt` or `setup.py` out of habit, reintroducing drift.
- **Mitigation**: explicit docs + CI drift check and/or removal of duplicate sources.

### Rollback Plan

- Revert documentation and enforcement changes, restoring the prior install commands while preserving the Epic’s constraints.

### Testing

- Verify install commands work on Windows + Linux (Python 3.13+):
  - `pip install .`
  - `pip install -e ".[dev]"`
  - CI install command used by workflows

## Change Log

| Date       | Version | Description                           | Author      |
| ---------- | ------- | ------------------------------------- | ----------- |
| 2025-12-16 | 0.1     | Initial draft for Epic 21.1           | bmad-master |
| 2025-01-XX | 1.0     | Completed - policy documented and enforced | Auto |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- Created `docs/DEPENDENCY_POLICY.md` documenting `pyproject.toml` as authoritative source
- Updated `docs/DEVELOPER_GUIDE.md` with install matrix and policy references
- Updated `CONTRIBUTING.md` with standard install commands and dependency validation step
- All acceptance criteria met: policy documented, dependency channels defined, requirements.txt role clarified

### File List

- `docs/DEPENDENCY_POLICY.md` (new)
- `docs/DEVELOPER_GUIDE.md` (updated)
- `CONTRIBUTING.md` (updated)

## QA Results

_TBD_



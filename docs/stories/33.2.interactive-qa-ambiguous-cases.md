# Story 33.2: Interactive Q&A for Ambiguous Cases

<!-- Source: implementation/EPIC_05_Workflow_Recommendation_Engine_Enhancement.md -->

## Status

**Ready for Review**

## Story

**As a** framework user,
**I want** the system to ask clarifying questions when workflow selection is ambiguous,
**so that** I get the most appropriate workflow recommendation for my specific situation.

## Acceptance Criteria

1. Ambiguous workflow selection scenarios are detected (low confidence, multiple valid options)
2. Q&A prompts are implemented to clarify user intent
3. Recommendation logic refines recommendations based on Q&A answers
4. Edge cases with multiple valid workflows are handled
5. Q&A flow is user-friendly and not overwhelming
6. Q&A can be skipped (non-interactive mode)

## Tasks / Subtasks

- [x] Task 1: Detect ambiguity (AC: 1)
  - [x] Check recommendation confidence
  - [x] Detect multiple valid workflows
  - [x] Identify ambiguous scenarios

- [x] Task 2: Create Q&A prompts (AC: 2, 5)
  - [x] Design clarifying questions
  - [x] Create prompt templates
  - [x] Ensure questions are clear and concise

- [x] Task 3: Refine recommendations (AC: 3)
  - [x] Process Q&A answers
  - [x] Update recommendation based on answers
  - [x] Re-run recommendation logic (simplified)

- [x] Task 4: Handle edge cases (AC: 4)
  - [x] Handle multiple valid workflows
  - [x] Handle conflicting answers
  - [x] Provide fallback recommendations

- [x] Task 5: Support skipping (AC: 6)
  - [x] Allow Q&A skip in non-interactive mode
  - [x] Use default recommendation if skipped
  - [x] Document skip behavior

## Dev Notes

### Existing System Context

- WorkflowRecommender exists
- Recommendation confidence available
- CLI command from Story 33.1
- Interactive prompt patterns

### Integration Approach

- Extend CLI command with Q&A
- Use recommender confidence scores
- Follow interactive CLI patterns
- Integrate with recommendation logic

### Risk Assessment

- **Primary risk**: Q&A may be too verbose
  - **Mitigation**: Limit questions, clear prompts, skip option

### Rollback Plan

- Remove Q&A functionality
- Use default recommendations
- No breaking changes

### Testing

- Test ambiguity detection
- Test Q&A flow
- Test recommendation refinement
- Test edge cases
- Test skip functionality

## Change Log

| Date       | Version | Description                     | Author      |
| ---------- | ------- | ------------------------------- | ----------- |
| 2025-01-XX | 0.1     | Initial draft for Epic 33.2     | bmad-master |

## Dev Agent Record

**Implementation Complete:**
- Implemented `_is_ambiguous()` function to detect low confidence (< 0.7) or multiple alternatives
- Created `_ask_clarifying_questions()` function with 3 key questions:
  1. Project scope (bug fix, feature, major refactor, enterprise)
  2. Time constraint (quick fix, standard, quality priority)
  3. Documentation needs (minimal, standard, comprehensive)
- Added `_refine_recommendation()` to process Q&A answers
- Q&A automatically skipped in non-interactive mode
- Questions are clear and concise, can be cancelled with Ctrl+C

**Files Modified:**
- `tapps_agents/cli/commands/top_level.py` - Added Q&A functions and integration

## QA Results

_TBD_


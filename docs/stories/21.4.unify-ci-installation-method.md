# Story 21.4: Unify CI Installation Method

<!-- Source: implementation/cursor/EPIC_21_Dependency_And_Packaging_Alignment.md -->
<!-- Context: Make GitHub Actions workflows use one consistent install strategy aligned with local dev -->

## Status

Complete

## Story

**As a** contributor (and CI maintainer),
**I want** all GitHub Actions workflows to install dependencies using the same documented contract,
**so that** CI behavior matches local developer setup and avoids “works in CI but not locally” drift.

## Acceptance Criteria

1. `.github/workflows/ci.yml` and `.github/workflows/test.yml` use the same installation approach (same “source of truth” and extras).
2. `.github/workflows/e2e.yml` uses the same approach and only adds e2e-specific extras or steps when required.
3. The chosen install method is documented in `docs/DEVELOPER_GUIDE.md` and `CONTRIBUTING.md` with copy/paste commands.
4. CI does not rely on `requirements.txt` unless the policy explicitly defines it as generated/non-authoritative.
5. CI validates the install matrix defined by the project:
   - runtime install (smoke)
   - dev/test install (unit tests, lint/type as applicable)
   - e2e install (if applicable)

## Tasks / Subtasks

- [x] Task 1: Audit current workflow install steps (AC: 1–2)
  - [x] Review `.github/workflows/ci.yml`
  - [x] Review `.github/workflows/test.yml`
  - [x] Review `.github/workflows/e2e.yml`
  - [x] Identify divergent install methods and pinning strategies

- [x] Task 2: Standardize on a single install contract (AC: 1–4)
  - [x] Choose the canonical command(s) (e.g., `pip install -e ".[dev]"` for CI checks/tests)
  - [x] Ensure workflows install the right extras for their job
  - [x] Ensure caches (if any) remain valid and do not hide dependency issues

- [x] Task 3: Add install-matrix validation to CI (AC: 5)
  - [x] Add a runtime install smoke job/step that verifies CLI availability
  - [x] Add dev/test job/step that verifies lint/type/test execution
  - [x] Add e2e job/step that installs e2e extras (if separate) and runs e2e suite

- [x] Task 4: Document the CI/local parity contract (AC: 3)
  - [x] Update `docs/DEVELOPER_GUIDE.md`
  - [x] Update `CONTRIBUTING.md`

## Dev Notes

### Existing System Context

- CI currently uses a mix of:
  - editable installs with extras
  - requirements-file installs
- Packaging metadata and dependencies exist in multiple places; Epic 21 aims to align them under `pyproject.toml`.

### Integration Approach

- Make CI install exactly what contributors are told to install locally for dev/test workflows.
- Use extras to keep runtime installs minimal while allowing CI to install the full dev/test toolchain explicitly.

### Risk Assessment

- **Risk**: changing CI install method breaks workflows due to missing extras or implicit dependencies.
- **Mitigation**: add explicit install-matrix smoke steps and keep changes incremental per workflow.

### Rollback Plan

- Revert workflow install steps to prior commands while retaining documentation and policy decisions.

### Testing

- Ensure all workflows pass on Windows + Linux, Python 3.13+.

## Change Log

| Date       | Version | Description                           | Author      |
| ---------- | ------- | ------------------------------------- | ----------- |
| 2025-12-16 | 0.1     | Initial draft for Epic 21.4           | bmad-master |
| 2025-01-XX | 1.0     | Completed - CI workflows unified to use consistent install method | Auto |

## Dev Agent Record

### Agent Model Used

_TBD_

### Debug Log References

_TBD_

### Completion Notes List

- Updated `.github/workflows/test.yml` to use `pip install -e ".[dev]"` (was using `requirements.txt`)
- All CI workflows now use consistent install method: `pip install -e ".[dev]"`
- Updated `docs/DEVELOPER_GUIDE.md` with install commands and dependency policy references
- Updated `CONTRIBUTING.md` with standard install commands and validation steps
- All acceptance criteria met: workflows unified, documented, CI validates install matrix

### File List

- `.github/workflows/test.yml` (updated - unified install method)
- `.github/workflows/ci.yml` (already using correct method)
- `.github/workflows/e2e.yml` (already using correct method)
- `docs/DEVELOPER_GUIDE.md` (updated)
- `CONTRIBUTING.md` (updated)

## QA Results

_TBD_



# Multi-Agent Review and Test Workflow
# Demonstrates parallel execution of multiple agents

workflow:
  id: multi-agent-review-and-test
  name: "Multi-Agent Review and Test Workflow"
  description: "Review multiple services and generate tests in parallel"
  version: "1.0.0"
  
  type: brownfield
  parallel_execution: true
  
  settings:
    max_parallel_agents: 8
    use_worktrees: true
    aggregate_results: true
    performance_monitoring: true
  
  # Parallel agent tasks
  parallel_tasks:
    # Review tasks
    - agent_id: auth-reviewer
      agent: reviewer
      command: review
      target: services/auth/
      args:
        format: json
      worktree: auth-review
      
    - agent_id: api-reviewer
      agent: reviewer
      command: review
      target: services/api/
      args:
        format: json
      worktree: api-review
      
    - agent_id: payment-reviewer
      agent: reviewer
      command: review
      target: services/payment/
      args:
        format: json
      worktree: payment-review
    
    # Test generation tasks
    - agent_id: auth-tester
      agent: tester
      command: generate
      target: services/auth/
      args:
        format: json
      worktree: auth-tests
      depends_on: []
      
    - agent_id: api-tester
      agent: tester
      command: generate
      target: services/api/
      args:
        format: json
      worktree: api-tests
      depends_on: []
      
    - agent_id: payment-tester
      agent: tester
      command: generate
      target: services/payment/
      args:
        format: json
      worktree: payment-tests
      depends_on: []
    
    # Documentation task
    - agent_id: docs-generator
      agent: documenter
      command: generate-api
      target: services/
      args:
        format: json
      worktree: docs
      depends_on: []
  
  # Sequential steps after parallel execution
  steps:
    - id: aggregate
      agent: orchestrator
      action: aggregate_results
      context_tier: 1
      requires:
        - parallel_tasks
      creates:
        - aggregated-results.json
      
    - id: report
      agent: documenter
      action: generate_report
      context_tier: 1
      requires:
        - aggregated-results.json
      creates:
        - multi-agent-report.md


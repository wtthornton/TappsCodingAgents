{
  "library": "types-pyyaml",
  "topic": "best-practices",
  "documentation": {
    "content": "## Streaming YAML Events for Low-Level Processing with PyYAML\n\n```python\nimport yaml\n\nyaml_document = \"\"\"\nusers:\n  - name: Alice\n    role: admin\n  - name: Bob\n    role: user\n\"\"\"\n\n# Scan for tokens\nprint(\"Tokens:\")\nfor token in yaml.scan(yaml_document):\n    print(f\"{token.__class__.__name__}: {token}\")\n\n# Parse for events\nprint(\"\\nEvents:\")\nfor event in yaml.parse(yaml_document):\n    print(f\"{event.__class__.__name__}: {event}\")\n\n# Compose to get representation tree\nnode = yaml.compose(yaml_document)\nprint(f\"\\nRoot node type: {node.__class__.__name__}\")\nprint(f\"Root node tag: {node.tag}\")\n```\n\n## Error Handling with Detailed Markers in PyYAML\n\n```python\nimport yaml\nfrom yaml import YAMLError\n\ninvalid_yaml = \"\"\"\nusers:\n  - name: Alice\n    age: 30\n  - name: Bob\n  age: invalid indentation\n\"\"\"\n\ntry:\n    data = yaml.safe_load(invalid_yaml)\nexcept yaml.scanner.ScannerError as e:\n    print(f\"Scanner Error: {e.problem}\")\n    print(f\"Problem location: line {e.problem_mark.line + 1}, column {e.problem_mark.column + 1}\")\n    print(f\"Context:\\n{e.problem_mark.get_snippet()}\")\nexcept yaml.parser.ParserError as e:\n    print(f\"Parser Error: {e.problem}\")\n    print(f\"Location: line {e.problem_mark.line + 1}\")\nexcept YAMLError as e:\n    print(f\"YAML Error: {e}\")\n\n# Handling constructor errors\nyaml_with_bad_tag = \"\"\"\nvalue: !UnknownTag\n  data: test\n\"\"\"\n\ntry:\n    data = yaml.safe_load(yaml_with_bad_tag)\nexcept yaml.constructor.ConstructorError as e:\n    print(f\"Constructor Error: {e.problem}\")\n    if e.problem_mark:\n        print(f\"At line {e.problem_mark.line + 1}, column {e.problem_mark.column + 1}\")\n```\n\n## Process Multiple YAML Documents in Streams with PyYAML\n\n```python\nimport yaml\n\n# Create multiple documents\ndocuments = [\n    {'type': 'user', 'id': 1, 'name': 'Alice'},\n    {'type': 'user', 'id': 2, 'name': 'Bob'},\n    {'type': 'config', 'version': '1.0'}\n]\n\n# Dump all documents to a single stream\nyaml_stream = yaml.safe_dump_all(\n    documents,\n    explicit_start=True,\n    explicit_end=False\n)\nprint(\"Multi-document stream:\")\nprint(yaml_stream)\n# Output:\n# ---\n# id: 1\n# name: Alice\n# type: user\n# ---\n# id: 2\n# name: Bob\n# type: user\n# ---\n# type: config\n# version: '1.0'\n\n# Load all documents from stream\nloaded_docs = list(yaml.safe_load_all(yaml_stream))\nprint(f\"\\nLoaded {len(loaded_docs)} documents\")\nfor i, doc in enumerate(loaded_docs, 1):\n    print(f\"Document {i}: {doc}\")\n```\n\n## Control YAML Output Formatting with PyYAML\n\n```python\nimport yaml\n\ndata = {\n    'database': {\n        'connections': [\n            {'host': 'db1.local', 'port': 5432},\n            {'host': 'db2.local', 'port': 5432},\n            {'host': 'db3.local', 'port': 5432}\n        ]\n    },\n    'cache': {'host': 'redis.local', 'port': 6379}\n}\n\n# Block style (default)\nprint(\"Block style:\")\nprint(yaml.dump(data, default_flow_style=False, indent=2))\n\n# Flow style (inline)\nprint(\"\\nFlow style:\")\nprint(yaml.dump(data, default_flow_style=True))\n# Output: {cache: {host: redis.local, port: 6379}, database: {connections: [{host: db1.local, port: 5432}, ...]}}\n\n# Canonical YAML\nprint(\"\\nCanonical:\")\nprint(yaml.dump(data, canonical=True))\n\n# Custom width and indentation\nprint(\"\\nCustom formatting:\")\nyaml_formatted = yaml.dump(\n    data,\n    default_flow_style=False,\n    indent=4,\n    width=50,\n    allow_unicode=True,\n    explicit_start=True,\n    explicit_end=True,\n    sort_keys=True\n)\nprint(yaml_formatted)\n```\n\n## High-Performance YAML Processing with LibYAML Extension\n\n```python\nimport yaml\n\n# Check if LibYAML is available\nprint(f\"LibYAML available: {yaml.__with_libyaml__}\")\n\nif yaml.__with_libyaml__:\n    # Use CLoader for fast parsing\n    yaml_data = \"\"\"\n    large_list:\n      - item1\n      - item2\n      - item3\n    \"\"\"\n\n    # Fast loading with CLoader\n    data = yaml.load(yaml_data, Loader=yaml.CLoader)\n    print(f\"Loaded with CLoader: {data}\")\n\n    # Fast dumping with CDumper\n    output = yaml.dump(data, Dumper=yaml.CDumper)\n    print(f\"Dumped with CDumper:\\n{output}\")\n\n    # For safe operations with C extension\n    try:\n        from yaml import CSafeLoader, CSafeDumper\n        safe_data = yaml.load(yaml_data, Loader=CSafeLoader)\n        safe_output = yaml.dump(safe_data, Dumper=CSafeDumper)\n        print(\"C-based safe loader/dumper available\")\n    except ImportError:\n        print(\"C-based safe loader/dumper not available\")\nelse:\n    # Fallback to pure Python implementation\n    data = yaml.safe_load(yaml_data)\n    output = yaml.safe_dump(data)\n```\n\n## Custom Resolvers for Implicit and Path-Based YAML Data\n\n```python\nimport yaml\nimport re\n\n# Add implicit resolver for email addresses\nemail_pattern = re.compile(r'^[w.-]+@[w.-]+.w+$')\nyaml.add_implicit_resolver('!email', email_pattern, first='abcdefghijklmnopqrstuvwxyz')\n\n# Add constructor for email tag\ndef email_constructor(loader, node):\n    value = loader.construct_scalar(node)\n    return {'email': value, 'domain': value.split('@')[1]}\n\nyaml.add_constructor('!email', email_constructor, Loader=yaml.SafeLoader)\n\nyaml_with_email = \"\"\"\nusers:\n  - name: Alice\n    contact: alice@example.com\n  - name: Bob\n    contact: bob@test.org\n\"\"\"\n\ndata = yaml.safe_load(yaml_with_email)\nprint(data)\n# Emails are automatically detected and processed\n\n# Path-based resolver for specific locations\nyaml.add_path_resolver(\n    '!version',\n    ['app', 'version'],\n    kind=str,\n    Loader=yaml.SafeLoader\n)\n\ndef version_constructor(loader, node):\n    value = loader.construct_scalar(node)\n    major, minor, patch = map(int, value.split('.'))\n    return {'major': major, 'minor': minor, 'patch': patch}\n\nyaml.add_constructor('!version', version_constructor, Loader=yaml.SafeLoader)\n\nyaml_with_version = \"\"\"\napp:\n  name: MyApp\n  version: 2.5.1\n\"\"\"\n\napp_data = yaml.safe_load(yaml_with_version)\nprint(f\"Version: {app_data['app']['version']}\")\n```\n\n## Safely Load YAML with PyYAML\n\n```python\n>>> yaml.safe_load(stream)\n```\n\n## Custom Object Serialization to YAML with PyYAML Representers\n\n```python\nimport yaml\n\nclass Database:\n    def __init__(self, host, port, name):\n        self.host = host\n        self.port = port\n        self.name = name\n\n# Define a representer for the Database class\ndef database_representer(dumper, data):\n    dict_representation = {\n        'host': data.host,\n        'port': data.port,\n        'database': data.name\n    }\n    return dumper.represent_mapping('!Database', dict_representation)\n\n# Register the representer\nyaml.add_representer(Database, database_representer, Dumper=yaml.SafeDumper)\n\n# Create and serialize custom objects\ndb_config = {\n    'primary': Database('db1.example.com', 5432, 'production'),\n    'replica': Database('db2.example.com', 5432, 'production_replica')\n}\n\nyaml_output = yaml.safe_dump(db_config, default_flow_style=False)\nprint(yaml_output)\n```\n\n## Load YAML Safely with PyYAML\n\n```python\nimport yaml\n\n# Safe loading of a single YAML document\nyaml_string = \"\"\"\nname: John Doe\nage: 30\nemail: john@example.com\nskills:\n  - Python\n  - YAML\n  - Docker\n\"\"\"\n\ndata = yaml.safe_load(yaml_string)\nprint(data)\n# Output: {'name': 'John Doe', 'age': 30, 'email': 'john@example.com', 'skills': ['Python', 'YAML', 'Docker']}\n\n# Safe loading from a file\nwith open('config.yaml', 'r') as file:\n    config = yaml.safe_load(file)\n    print(f\"Database: {config.get('database', {}).get('host', 'localhost')}\")\n\n# Loading multiple YAML documents from a stream\nmulti_doc_yaml = \"\"\"\n---\ndocument: 1\ntype: config\n---\ndocument: 2\ntype: data\n\"\"\"\n\nfor doc in yaml.safe_load_all(multi_doc_yaml):\n    print(f\"Document {doc['document']}: {doc['type']}\")\n# Output:\n# Document 1: config\n# Document 2: data\n\n```\n\n## Parse YAML with Custom Tag using PyYAML\n\n```python\nimport yaml\n\nyaml_with_custom_tag = \"\"\"\nemployees:\n  - !Person\n    name: Alice Smith\n    age: 28\n    email: alice@example.com\n  - !Person\n    name: Bob Jones\n    age: 35\n    email: bob@example.com\n\"\"\"\n\ndata = yaml.safe_load(yaml_with_custom_tag)\nfor employee in data['employees']:\n    print(employee)\n```\n\nContext7 cache for types-pyyaml: cached at 2026-01-30T06:13:26.647287+00:00Z; consider refreshing if docs changed.",
    "library": "types-pyyaml",
    "topic": "best-practices",
    "source": "cache"
  },
  "source": "cache",
  "saved_at": "2026-01-29T22:13:26.721328"
}
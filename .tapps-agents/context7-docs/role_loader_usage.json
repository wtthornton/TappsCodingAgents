{
  "library": "role_loader",
  "topic": "usage",
  "documentation": {
    "content": "## Implement Kubernetes Controller for Resource Watching (Go)\n\n```go\n// internal/pkg/controller/controller.go - Controller pattern for resource watching\npackage controller\n\nimport (\n\t\"github.com/stakater/Reloader/internal/pkg/handler\"\n\t\"k8s.io/client-go/kubernetes\"\n\t\"k8s.io/client-go/tools/cache\"\n)\n\n// NewController creates a new controller for watching ConfigMaps or Secrets\nfunc NewController(\n\tclient kubernetes.Interface,\n\tresource string,\n\tnamespace string,\n\tignoredNamespaces []string,\n\tnamespaceLabelSelector string,\n\tresourceLabelSelector string,\n) (*Controller, error) {\n\n\t// Create work queue for handling events\n\tqueue := workqueue.NewTypedRateLimitingQueue(\n\t\tworkqueue.DefaultTypedControllerRateLimiter[any]())\n\n\t// Create informer with event handlers\n\t_, informer := cache.NewInformerWithOptions(cache.InformerOptions{\n\t\tListerWatcher: listWatcher,\n\t\tObjectType:    kube.ResourceMap[resource],\n\t\tResyncPeriod:  0,\n\t\tHandler: cache.ResourceEventHandlerFuncs{\n\t\t\tAddFunc:    c.Add,      // Handle resource creation\n\t\t\tUpdateFunc: c.Update,   // Handle resource updates\n\t\t\tDeleteFunc: c.Delete,   // Handle resource deletion\n\t\t},\n\t})\n\n\treturn &Controller{\n\t\tclient:   client,\n\t\tinformer: informer,\n\t\tqueue:    queue,\n\t}, nil\n}\n\n// Run starts the controller\nfunc (c *Controller) Run(threadiness int, stopCh chan struct{}) {\n\tgo c.informer.Run(stopCh)\n\n\t// Wait for cache sync\n\tif !cache.WaitForCacheSync(stopCh, c.informer.HasSynced) {\n\t\treturn\n\t}\n\n\t// Start workers\n\tfor i := 0; i < threadiness; i++ {\n\t\tgo wait.Until(c.runWorker, time.Second, stopCh)\n\t}\n\n\t<-stopCh\n}\n\n```\n\n## Custom Kustomize Setup using Reloader\n\n```yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n  - https://github.com/stakater/Reloader/deployments/kubernetes\n\nnamespace: reloader\n```\n\n## Implement GitOps Friendly Rollout Strategy with Restart Mode\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: gitops-app\n  annotations:\n    reloader.stakater.com/auto: \"true\"\n    # Use restart strategy to avoid ArgoCD detecting drift\n    reloader.stakater.com/rollout-strategy: \"restart\"\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: gitops-app\n  template:\n    metadata:\n      labels:\n        app: gitops-app\n    spec:\n      containers:\n        - name: app\n          image: app:1.0.0\n          envFrom:\n            - configMapRef:\n                name: app-config\n\n```\n\n## Apply Helm3 Labels and Annotations to Kubernetes Resources\n\n```yaml\napp.kubernetes.io/managed-by=Helm\n```\n\n## Apply Helm3 Labels and Annotations to Kubernetes Resources\n\n```yaml\nmeta.helm.sh/release-name=<release-name>\nmeta.helm.sh/release-namespace=<namespace>\n```\n\n## Apply Helm3 Labels and Annotations to Kubernetes Resources\n\n```bash\nKIND=ClusterRoleBinding\nNAME=reloader-reloader-role-binding\nRELEASE=reloader\nNAMESPACE=kube-system\nkubectl annotate $KIND $NAME meta.helm.sh/release-name=$RELEASE\nkubectl annotate $KIND $NAME meta.helm.sh/release-namespace=$NAMESPACE\nkubectl label $KIND $NAME app.kubernetes.io/managed-by=Helm\n\nKIND=ClusterRole\nNAME=reloader-reloader-role\nRELEASE=reloader\nNAMESPACE=kube-system\nkubectl annotate $KIND $NAME meta.helm.sh/release-name=$RELEASE\nkubectl annotate $KIND $NAME meta.helm.sh/release-namespace=$NAMESPACE\nkubectl label $KIND $NAME app.kubernetes.io/managed-by=Helm\n```\n\n## Deploy Reloader to Specific Namespace with Helm\n\n```bash\nhelm --namespace {replace this with namespace name} template . > reloader.yaml\n```\n\n## Helm Installation with Custom Values\n\n```bash\nhelm install reloader stakater/reloader -f values.yaml\n```\n\n## Kubernetes Deployment Configuration with Runtime Flags\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: reloader\n  namespace: reloader\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: reloader\n  template:\n    metadata:\n      labels:\n        app: reloader\n    spec:\n      serviceAccountName: reloader\n      containers:\n        - name: reloader\n          image: stakater/reloader:v1.4.12\n          args:\n            - --reload-on-create=true\n            - --reload-on-delete=true\n            - --auto-reload-all=true\n            - --reload-strategy=annotations\n            - --ignored-workload-types=jobs,cronjobs\n            - --namespace-selector=env=production\n            - --resource-label-selector=watch=true\n            - --namespaces-to-ignore=kube-system,kube-public\n            - --log-format=json\n            - --enable-pprof\n            - --pprof-addr=:6060\n          env:\n            - name: ALERT_ON_RELOAD\n              value: \"true\"\n            - name: ALERT_SINK\n              value: \"webhook\"\n            - name: ALERT_WEBHOOK_URL\n              value: \"https://webhook.site/your-unique-id\"\n          ports:\n            - containerPort: 9090\n              name: metrics\n            - containerPort: 6060\n              name: pprof\n          resources:\n            limits:\n              cpu: 150m\n              memory: 512Mi\n            requests:\n              cpu: 10m\n              memory: 128Mi\n```\n\n## Example of Ignoring Workload Types in Reloader\n\n```bash\n# Ignore only Jobs\n--ignored-workload-types=jobs\n\n# Ignore only CronJobs\n--ignored-workload-types=cronjobs\n\n# Ignore both Jobs and CronJobs (comma-separated)\n--ignored-workload-types=jobs,cronjobs\n```\n\n## Install Reloader with Kustomize\n\n```yaml\n# kustomization.yaml\napiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n  - https://github.com/stakater/Reloader/deployments/kubernetes\n\nnamespace: reloader\n```\n\n## Install Reloader with Kustomize\n\n```bash\n# Apply with kubectl\nkubectl apply -k .\n```\n\n## Set Restart Rollout Strategy for Workloads\n\n```yaml\nmetadata:\n  annotations:\n    reloader.stakater.com/rollout-strategy: \"restart\"\n```",
    "library": "role_loader",
    "topic": "best-practices",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-01-30T18:25:45.143888"
}
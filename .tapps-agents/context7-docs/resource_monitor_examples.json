{
  "library": "resource_monitor",
  "topic": "examples",
  "documentation": {
    "content": "## Invoking CNS Manager API with cURL\n\n```shell\ncurl -X 'GET' 'http://10.184.71.61:30008/1.0.0/datastoreresources?datacenter=VSAN-DC&datastore=vsanDatastore' -H 'accept: application/json' -u \"Admistrator:Admin123@\"\n\n```\n\n## Set New Release Image for cns-manager Deployment\n\n```bash\nkubectl set image deployment/cns-manager cns-manager=projects.registry.vmware.com/cns_manager/cns-manager:r0.2.0 -n <cns-manager-namespace>\n```\n\n## GET /orphansnapshots\n\n```APIDOC\n## GET /orphansnapshots\n\n### Description\nThis API is used to get list of orphan snapshots. It takes optional parameters, datacenter & list of datastores, and returns orphan snapshots for them.\n- If datacenter is not specified, then it returns all orphan snapshots in the vCenter (all datastores on all datacenters ).\n- If only datacenter is specified, then it returns orphan snapshots in all datastores in the datacenter.\n- If both datacenter & list of datastores is specified, it returns orphan snapshots in specified datastores on the datacenter.\n\nThis API also takes optional parameter snapshotPrefix, which indicates the prefix used in the snapshot description. So, this API returns orphan snapshots whose description\u2019s prefix matches with the specified snapshot prefix. Default value of this parameter is \u201csnapshot\u201d.\n\nThere could be hundreds of orphan snapshots, so this API supports pagination as well. It takes optional parameters limit (default value 50) and offset (default value 0). Limit specifies the maximum entries that should be displayed in single request, whereas offset specifies the starting point of the result set.\n\nDetection of orphan snapshots can be a time-consuming operation if there are large number of orphans. Hence it is performed asynchronously at regular intervals and the response is cached. This API returns list of orphan snapshots computed in the last run, along with the next operation interval (`RetryAfterMinutes`).\n\n**Note:** For newly deployed CNS manager application, when orphan snapshots are being computed in the background for the first time, the API may return no orphan snapshots. It should then be re-tried after `RetryAfterMinutes` to get orphan snapshots computed in the latest run.\n\n### Method\nGET\n\n### Endpoint\n/orphansnapshots\n\n### Parameters\n#### Query Parameters\n- **datacenter** (string) - Optional - The datacenter to filter orphan snapshots by.\n- **datastores** (array[string]) - Optional - A list of datastores within the specified datacenter to filter orphan snapshots by.\n- **snapshotPrefix** (string) - Optional - The prefix to match in the snapshot description. Defaults to \"snapshot\".\n- **limit** (integer) - Optional - The maximum number of entries to return. Defaults to 50.\n- **offset** (integer) - Optional - The starting point of the result set. Defaults to 0.\n\n### Response\n#### Success Response (200)\n- **orphanSnapshots** (array) - A list of orphan snapshot objects.\n- **RetryAfterMinutes** (integer) - The number of minutes until the next operation interval.\n\n#### Response Example\n```json\n{\n  \"orphanSnapshots\": [\n    {\n      \"snapshotId\": \"snapshot-123\",\n      \"snapshotName\": \"my-orphan-snapshot\",\n      \"creationTime\": \"2023-10-27T10:00:00Z\",\n      \"sizeInMB\": 1024\n    }\n  ],\n  \"RetryAfterMinutes\": 60\n}\n```\n```\n\n## Deletion Failure for Orphan Snapshots of Orphan Volumes\n\n```APIDOC\n## DELETE /orphansnapshots\n\n### Description\nAttempting to delete an orphan snapshot that belongs to an orphan volume using the DELETE /orphansnapshots API fails with an error indicating the volume is not registered as a CNS Volume.\n\n### Method\nDELETE\n\n### Endpoint\n/orphansnapshots\n\n### Parameters\nThis endpoint does not appear to accept direct parameters for this specific use case causing failure.\n\n### Request Body\nNot applicable for the failing scenario.\n\n### Response\n#### Error Response\n- **message** (string) - The error message returned upon failure, e.g., \"Volume with ID xxxx is not registered as a CNS Volume.\"\n\n#### Error Response Example\n```json\n{\n  \"message\": \"Volume with ID xxxx is not registered as a CNS Volume.\"\n}\n```\n\n### Workaround\nTo delete orphan snapshots, use the following APIs instead:\n\n- **DELETE /volumes/{volumeId}/snapshots** (to delete all snapshots for a volume)\n- **DELETE /volumes/{volumeId}/snapshots/{snapshotId}** (to delete a specific snapshot)\n\n### Planned Improvement\nThe detection algorithm will be enhanced in future updates to handle these scenarios without requiring manual invocation of alternative APIs.\n```\n\n## GET /volumes/{volumeId}/snapshots\n\n```APIDOC\n## GET /volumes/{volumeId}/snapshots\n\n### Description\nThis API lists all the snapshots for a specific volume. It takes required parameters datacenter and datastore name to which volume and snapshots belong to.  \nThis API also takes optional parameter snapshotPrefix which indicates the prefix used in snapshot description. If snapshot prefix is not specified, then it lists all snapshots of a volume. Otherwise it lists only those snapshots of volume whose description\u2019s prefix matches with the specified snapshot prefix.\n\n### Method\nGET\n\n### Endpoint\n/volumes/{volumeId}/snapshots\n\n### Parameters\n#### Path Parameters\n- **volumeId** (string) - Required - The ID of the volume.\n\n#### Query Parameters\n- **datacenter** (string) - Required - The datacenter where the volume and snapshots reside.\n- **datastore** (string) - Required - The datastore where the volume and snapshots reside.\n- **snapshotPrefix** (string) - Optional - The prefix to match in the snapshot description.\n\n### Response\n#### Success Response (200)\n- **snapshots** (array) - A list of snapshot objects for the specified volume.\n\n#### Response Example\n```json\n{\n  \"snapshots\": [\n    {\n      \"snapshotId\": \"snapshot-xyz\",\n      \"snapshotName\": \"backup-20231027\",\n      \"creationTime\": \"2023-10-27T11:00:00Z\",\n      \"sizeInMB\": 512\n    }\n  ]\n}\n```\n```\n\n## List Volume Snapshots using cURL and Go\n\n```bash\ncurl -X 'GET' \\\n  \"http://cns-manager.example.com:30008/1.0.0/volumes/ae903e93-b589-4cda-a3af-e59ef4660325/snapshots?datacenter=VSAN-DC&datastore=vsanDatastore&snapshotPrefix=snapshot\" \\\n  -H 'accept: application/json' \\\n  -u \"Administrator:Admin123@\"\n```\n\n## List Volume Snapshots using cURL and Go\n\n```go\nvolumeId := \"ae903e93-b589-4cda-a3af-e59ef4660325\"\ndatacenter := \"VSAN-DC\"\ndatastore := \"vsanDatastore\"\n\nopts := &apiclient.SnapshotForVolumeApiListAllSnapshotsForVolumeOpts{\n    SnapshotPrefix: optional.NewString(\"snapshot\"),\n}\n\nresult, resp, err := client.SnapshotForVolumeApi.ListAllSnapshotsForVolume(ctx, volumeId, datacenter, datastore, opts)\nif err != nil {\n    panic(err)\n}\n// result contains SnapshotsForVolumeResult with:\n// - Snapshots: array of snapshot details for the volume\n```\n\n## DELETE /orphansnapshots\n\n```APIDOC\n## DELETE /orphansnapshots\n\n### Description\nThis API is used to delete orphan snapshots. It takes optional parameters, datacenter & list of datastores, and deletes orphan snapshots from them with the same logic explained above.\nThis API also takes optional parameter snapshotPrefix, which indicates the prefix used in the snapshot description.\n\nPlease note if there are large number of orphan snapshots in the system or if there's a slowness in vCenter networking/storage, the orphan snapshot deletion may take longer. That is why, orphan snapshot deletion operation is performed asynchronously.\nIt creates a job to delete these orphan snapshots in the background and returns the job Id to user, the status of this job can be retrieved using `getjobstatus` API.\n\n### Method\nDELETE\n\n### Endpoint\n/orphansnapshots\n\n### Parameters\n#### Query Parameters\n- **datacenter** (string) - Optional - The datacenter to filter orphan snapshots by.\n- **datastores** (array[string]) - Optional - A list of datastores within the specified datacenter to filter orphan snapshots by.\n- **snapshotPrefix** (string) - Optional - The prefix to match in the snapshot description.\n\n### Response\n#### Success Response (202 Accepted)\n- **jobId** (string) - The ID of the asynchronous job created for deletion.\n\n#### Response Example\n```json\n{\n  \"jobId\": \"job-abc-123\"\n}\n```\n```\n\n## DELETE /volumes/{volumeId}/snapshots/{snapshotId}\n\n```APIDOC\n## DELETE /volumes/{volumeId}/snapshots/{snapshotId}\n\n### Description\nDeletes a specific snapshot associated with a specified volume. This operation is part of a workaround to enable the deletion of orphan volumes that have snapshots.\n\n### Method\nDELETE\n\n### Endpoint\n`/volumes/{volumeId}/snapshots/{snapshotId}`\n\n### Parameters\n#### Path Parameters\n- **volumeId** (string) - Required - The unique identifier of the volume.\n- **snapshotId** (string) - Required - The unique identifier of the snapshot to delete.\n```\n\n## List Orphan Snapshots using cURL and Go\n\n```bash\ncurl -X 'GET' \\\n  \"http://cns-manager.example.com:30008/1.0.0/orphansnapshots?datacenter=VSAN-DC&datastores=vsanDatastore&snapshotPrefix=snapshot&limit=50&offset=0\" \\\n  -H 'accept: application/json' \\\n  -u \"Administrator:Admin123@\"\n```\n\n## List Orphan Snapshots using cURL and Go\n\n```go\nopts := &apiclient.OrphanSnapshotApiOrphanSnapshotsListOpts{\n    Datacenter:     optional.NewString(\"VSAN-DC\"),\n    Datastores:     optional.NewString(\"vsanDatastore\"),\n    SnapshotPrefix: optional.NewString(\"snapshot\"),\n    Limit:          optional.NewInt64(50),\n    Offset:         optional.NewInt64(0),\n}\n\nresult, resp, err := client.OrphanSnapshotApi.OrphanSnapshotsList(ctx, opts)\nif err != nil {\n    panic(err)\n}\n// result contains OrphanSnapshotResult with:\n// - TotalOrphanSnapshots: total count\n// - OrphanSnapshots: array of snapshot details\n// - RetryAfterMinutes: when to retry for updated list\n// - Limit, Offset: pagination info\n```\n\n## DELETE /volumes/{volumeId}/snapshots/{snapshotId}\n\n```APIDOC\n## DELETE /volumes/{volumeId}/snapshots/{snapshotId}\n\n### Description\nThis API deletes a specific snapshot belonging to a volume. It takes required parameters datacenter and datastore name to which volume and snapshot belongs to.  \nDeletion of a snapshot is performed asynchronously. It creates a job to delete this snapshot in the background and returns the job Id to user, the status of this job can be retrieved using `getjobstatus` API.\n\n### Method\nDELETE\n\n### Endpoint\n/volumes/{volumeId}/snapshots/{snapshotId}\n\n### Parameters\n#### Path Parameters\n- **volumeId** (string) - Required - The ID of the volume.\n- **snapshotId** (string) - Required - The ID of the snapshot to delete.\n\n#### Query Parameters\n- **datacenter** (string) - Required - The datacenter where the volume and snapshot reside.\n- **datastore** (string) - Required - The datastore where the volume and snapshot reside.\n\n### Response\n#### Success Response (202 Accepted)\n- **jobId** (string) - The ID of the asynchronous job created for deletion.\n\n#### Response Example\n```json\n{\n  \"jobId\": \"job-ghi-789\"\n}\n```\n```",
    "library": "storage_manager",
    "topic": "examples",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-02-06T15:36:10.889719"
}
{
  "library": "worktree",
  "topic": null,
  "documentation": {
    "content": "## List Git Worktrees with Treehouse API\n\n```typescript\nimport { treehouse } from 'treehouse-worktree';\n\nconst result = await treehouse.list();\n\nif (result.success && result.data) {\n  const worktrees = result.data as Array<{ \n    path: string;\n    branch?: string;\n    name?: string;\n    bare?: boolean;\n    locked?: boolean;\n    lock?: { agentId: string; expiresAt?: string };\n  }>;\n\n  worktrees.forEach(wt => {\n    console.log(`${wt.name}: ${wt.branch} at ${wt.path}`);\n    if (wt.lock) {\n      console.log(`  Locked by: ${wt.lock.agentId}`);\n      console.log(`  Expires: ${wt.lock.expiresAt}`);\n    }\n  });\n}\n```\n\n## Multi-Agent Workflow Example with Treehouse CLI\n\n```bash\n# Agent 1 starts working on API\ntreehouse create api-work --agent agent-1 --message \"Implementing REST endpoints\"\n\n# Agent 2 starts working on UI (different worktree)\ntreehouse create ui-work --agent agent-2 --message \"Building dashboard components\"\n\n# Check what's being worked on\ntreehouse list\n\n# Agent 1 finishes and merges\ntreehouse complete api-work --merge --delete-branch\ntreehouse remove api-work\n\n# Agent 2 finishes\ntreehouse complete ui-work --merge\ntreehouse remove ui-work\n```\n\n## Available MCP Tools for Treehouse\n\n```typescript\n// Available tools in MCP server\nconst tools = [\n  { name: 'treehouse_init', description: 'Initialize configuration' },\n  { name: 'treehouse_list', description: 'List all worktrees' },\n  { name: 'treehouse_create', description: 'Create new worktree' },\n  { name: 'treehouse_status', description: 'Get worktree status' },\n  { name: 'treehouse_complete', description: 'Complete and merge work' },\n  { name: 'treehouse_remove', description: 'Remove worktree' },\n  { name: 'treehouse_lock', description: 'Lock worktree' },\n  { name: 'treehouse_unlock', description: 'Unlock worktree' },\n  { name: 'treehouse_conflicts', description: 'Check conflicts' },\n  { name: 'treehouse_resolve', description: 'Resolve conflicts' },\n  { name: 'treehouse_abort', description: 'Abort merge' },\n  { name: 'treehouse_prune', description: 'Prune orphaned entries' },\n  { name: 'treehouse_clean', description: 'Clean old worktrees' }\n];\n\n// Example: Merge with conflict resolution\n// 1. Complete the worktree with merge\ntreehouse_complete({ name: 'feature-api', merge: true })\n\n// 2. If conflicts occur, check them\ntreehouse_conflicts({ name: 'feature-api' })\n\n// 3. Resolve using strategy\ntreehouse_resolve({ name: 'feature-api', strategy: 'theirs' })\n```\n\n## Worktree Status API\n\n```APIDOC\n## GET /api/worktree/status\n\n### Description\nRetrieves detailed status information for a specific worktree including git status, recent commits, uncommitted changes, and lock information. If no name is provided, returns status for all worktrees.\n\n### Method\nGET\n\n### Endpoint\n/api/worktree/status\n\n### Parameters\n#### Query Parameters\n- **name** (string) - Optional - The name of the worktree to get the status for. If omitted, status for all worktrees is returned.\n\n### Response\n#### Success Response (200)\n- **success** (boolean) - Indicates if the operation was successful.\n- **data** (object or array) - If `name` is provided, an object with status details. If `name` is omitted, an array of status objects for all worktrees.\n  - **name** (string) - The name of the worktree.\n  - **branch** (string) - The current branch of the worktree.\n  - **path** (string) - The file system path of the worktree.\n  - **currentBranch** (string) - The current git branch.\n  - **hasUncommittedChanges** (boolean) - Indicates if there are uncommitted changes.\n  - **gitStatus** (string) - The output of `git status`.\n  - **recentCommits** (string) - A summary of recent commits.\n  - **lock** (object) - Optional - Information about the lock.\n    - **agentId** (string) - The ID of the agent holding the lock.\n\n#### Response Example (Single Worktree)\n```json\n{\n  \"success\": true,\n  \"data\": {\n    \"name\": \"feature-api\",\n    \"branch\": \"feature/new-api\",\n    \"path\": \"/path/to/repo/.treehouse/feature-api\",\n    \"currentBranch\": \"feature/new-api\",\n    \"hasUncommittedChanges\": false,\n    \"gitStatus\": \"On branch feature/new-api\\nnothing to commit, working tree clean\",\n    \"recentCommits\": \"(No recent commits found)\",\n    \"lock\": {\n      \"agentId\": \"claude-1\"\n    }\n  }\n}\n```\n\n#### Response Example (All Worktrees)\n```json\n{\n  \"success\": true,\n  \"data\": [\n    {\n      \"name\": \"feature-api\",\n      \"branch\": \"feature/new-api\",\n      \"path\": \"/path/to/repo/.treehouse/feature-api\",\n      \"currentBranch\": \"feature/new-api\",\n      \"hasUncommittedChanges\": false,\n      \"gitStatus\": \"On branch feature/new-api\\nnothing to commit, working tree clean\",\n      \"recentCommits\": \"(No recent commits found)\",\n      \"lock\": {\n        \"agentId\": \"claude-1\"\n      }\n    },\n    {\n      \"name\": \"bugfix-123\",\n      \"branch\": \"bugfix/issue-123\",\n      \"path\": \"/path/to/repo/.treehouse/bugfix-123\",\n      \"currentBranch\": \"bugfix/issue-123\",\n      \"hasUncommittedChanges\": true,\n      \"gitStatus\": \"On branch bugfix/issue-123\\nChanges not staged for commit:\\n  (use \\\"git add <file>...\\\" to update what will be committed)\\n  (use \\\"git restore <file>...\\\" to discard changes in working directory)\\n\\n        modified:   src/index.ts\",\n      \"recentCommits\": \"(No recent commits found)\"\n    }\n  ]\n}\n```\n```\n\n## Conflict Resolution CLI\n\n```APIDOC\n## Conflict Resolution via CLI\n\nHandle merge conflicts using command-line strategies or abort merge operations.\n\n### Check for conflicts\n\n```bash\n# Check for conflicts in all worktrees\ntreehouse conflicts\n\n# Check specific worktree\ntreehouse conflicts feature-api\n```\n\n### Resolve conflicts\n\n```bash\n# Resolve conflicts using 'theirs' strategy (accept incoming changes)\ntreehouse resolve feature-api --theirs\n\n# Resolve using 'ours' strategy (keep current changes)\ntreehouse resolve feature-api --ours\n```\n\n### Abort merge\n\n```bash\n# Abort merge and restore previous state\ntreehouse abort feature-api\n```\n```\n\n## Conflict Resolution in treehouse-worktree\n\n```bash\n# Check for conflicts\ntreehouse conflicts\ntreehouse conflicts feature-api  # in specific worktree\n\n# Resolve conflicts\ntreehouse resolve --ours         # keep current branch changes\ntreehouse resolve --theirs       # accept incoming changes\ntreehouse resolve feature-api --theirs\n\n# Abort merge\ntreehouse abort\ntreehouse abort feature-api\n```\n\n## Clean Old Worktrees\n\n```APIDOC\n## Clean Old Worktrees\n\n### Description\nRemoves worktrees based on retention policies defined in configuration. Supports dry-run mode to preview what would be removed.\n\n### Method\nVarious (internal API calls represented by `treehouse.clean` in TypeScript SDK)\n\n### Parameters\n- **dryRun** (boolean) - Required - If true, simulates the cleaning process without removing any worktrees.\n\n### Request Example (Dry Run)\n```typescript\nawait treehouse.clean({ dryRun: true });\n```\n\n### Request Example (Actual Clean)\n```typescript\nawait treehouse.clean({ dryRun: false });\n```\n\n### Response\n#### Success Response (Dry Run)\n- **success** (boolean) - True if the dry run simulation was successful.\n- **data** (object) - Contains information about worktrees that would be removed.\n  - **wouldRemove** (array of objects) - A list of worktrees that would be removed.\n    - **name** (string) - The name of the worktree.\n    - **lastAccessed** (string) - The timestamp of the last access for the worktree.\n\n#### Success Response (Actual Clean)\n- **success** (boolean) - True if the cleaning process was successful.\n- **data** (object) - Contains information about the cleaning operation.\n  - **removed** (array of strings) - A list of worktree names that were removed.\n  - **errors** (array of strings) - Optional list of errors encountered during cleaning.\n\n#### Response Example (Dry Run Success)\n{\n  \"success\": true,\n  \"data\": {\n    \"wouldRemove\": [\n      { \"name\": \"old-feature\", \"lastAccessed\": \"2023-10-20T09:00:00Z\" }\n    ]\n  }\n}\n\n#### Response Example (Actual Clean Success)\n{\n  \"success\": true,\n  \"data\": {\n    \"removed\": [\"old-feature\"]\n  }\n}\n```\n\n## Programmatic Worktree Management with Treehouse Library\n\n```typescript\nimport { treehouse } from 'treehouse-worktree';\n\n// Create a worktree\nconst result = await treehouse.create({\n  name: 'feature-api',\n  agentId: 'my-agent',\n  lockMessage: 'Working on API'\n});\n\n// List worktrees\nconst list = await treehouse.list();\n\n// Complete work\nawait treehouse.complete({\n  name: 'feature-api',\n  merge: true,\n  deleteBranch: true\n});\n```\n\n## Setup Commands for Worktree\n\n```json\n{\n  \"setup-worktree\": [\n    \"npm install\",\n    \"cp $ROOT_WORKTREE_PATH/.env .env\"\n  ]\n}\n```\n\n## Complete Worktree API\n\n```APIDOC\n## POST /api/worktree/complete\n\n### Description\nCompletes work on a worktree with optional merge into target branch, squash merge, and branch deletion. Handles merge conflicts and provides detailed feedback.\n\n### Method\nPOST\n\n### Endpoint\n/api/worktree/complete\n\n### Parameters\n#### Request Body\n- **name** (string) - Required - The name of the worktree to complete.\n- **merge** (boolean) - Optional - Whether to merge the worktree's branch into the target branch. Defaults to `false`.\n- **squash** (boolean) - Optional - Whether to perform a squash merge. Only applicable if `merge` is `true`. Defaults to `false`.\n- **targetBranch** (string) - Optional - The branch to merge into. Use 'current' to merge into the worktree's current branch. Defaults to 'main'.\n- **deleteBranch** (boolean) - Optional - Whether to delete the worktree's branch after merging. Defaults to `false`.\n- **message** (string) - Optional - A commit message to use if performing a merge or squash.\n\n### Request Example\n```json\n{\n  \"name\": \"feature-api\",\n  \"merge\": true,\n  \"squash\": true,\n  \"targetBranch\": \"main\",\n  \"deleteBranch\": true,\n  \"message\": \"Add new API endpoints with authentication\"\n}\n```\n\n### Response\n#### Success Response (200)\n- **success** (boolean) - Indicates if the operation was successful.\n- **message** (string) - A message describing the outcome.\n- **data** (object) - Contains details about the completion.\n  - **mergedBranch** (string) - The branch that was merged.\n  - **targetBranch** (string) - The branch into which it was merged.\n  - **branchDeleted** (boolean) - Indicates if the source branch was deleted.\n\n#### Conflict Response (Non-200, e.g., 409 Conflict)\n- **success** (boolean) - Indicates if the operation was successful (will be `false` in case of conflicts).\n- **data** (object) - Contains details about the merge conflict.\n  - **conflicts** (array) - A list of files with merge conflicts.\n  - **worktreeBranch** (string) - The branch of the worktree.\n  - **targetBranch** (string) - The target branch for the merge.\n\n#### Response Example (Success)\n```json\n{\n  \"success\": true,\n  \"message\": \"Worktree 'feature-api' completed and merged successfully.\",\n  \"data\": {\n    \"mergedBranch\": \"feature/new-api\",\n    \"targetBranch\": \"main\",\n    \"branchDeleted\": true\n  }\n}\n```\n\n#### Response Example (Merge Conflict)\n```json\n{\n  \"success\": false,\n  \"data\": {\n    \"conflicts\": [\n      \"src/api/handler.ts\",\n      \"src/auth/middleware.ts\"\n    ],\n    \"worktreeBranch\": \"feature/new-api\",\n    \"targetBranch\": \"main\"\n  }\n}\n```\n```\n",
    "library": "worktree",
    "topic": "overview",
    "source": "api"
  },
  "source": "api",
  "saved_at": "2026-01-30T18:29:47.605302"
}
{
  "library": "clean",
  "topic": "best-practices",
  "documentation": {
    "content": "## Clean Array of HTML Strings with Purify\n\n```php\nuse Stevebauman\\Purify\\Facades\\Purify;\n\n// Array of user-submitted content\n$inputs = [\n    '<script>alert(\"Harmful\");</script><p>First post</p>',\n    '<img src=\"x\" onerror=\"alert(1)\"><p>Second post</p>',\n    '<a href=\"javascript:void(0)\">Click me</a><p>Third post</p>'\n];\n\n// Clean all entries\n$cleaned = Purify::clean($inputs);\n\n// Output: ['<p>First post</p>', '<p>Second post</p>', '<p>Third post</p>']\nvar_dump($cleaned);\n```\n\n## Custom HTML Definition for Sanitization (PHP)\n\n```php\n// app/Definitions/TrixDefinition.php\nnamespace App\\Definitions;\n\nuse HTMLPurifier_HTMLDefinition;\nuse Stevebauman\\Purify\\Definitions\\Definition;\n\nclass TrixDefinition implements Definition\n{\n    public static function apply(HTMLPurifier_HTMLDefinition $definition)\n    {\n        // Add figure element for attachments\n        $definition->addElement('figure', 'Inline', 'Inline', 'Common');\n        $definition->addAttribute('figure', 'class', 'Class');\n        $definition->addAttribute('figure', 'data-trix-attachment', 'Text');\n        $definition->addAttribute('figure', 'data-trix-attributes', 'Text');\n\n        // Add figcaption for attachment captions\n        $definition->addElement('figcaption', 'Inline', 'Inline', 'Common');\n        $definition->addAttribute('figcaption', 'class', 'Class');\n        $definition->addAttribute('figcaption', 'data-trix-placeholder', 'Text');\n\n        // Extend anchor tag with Trix-specific attributes\n        $definition->addAttribute('a', 'data-trix-attachment', 'Text');\n        $definition->addAttribute('a', 'data-trix-content-type', 'Text');\n        $definition->addAttribute('a', 'contenteditable', 'Enum#true,false');\n    }\n}\n\n// config/purify.php\nreturn [\n    'definitions' => \\App\\Definitions\\TrixDefinition::class,\n    // ... other config\n];\n\n// Usage\nuse Stevebauman\\Purify\\Facades\\Purify;\n\n$trixContent = '<figure data-trix-attachment=\\'{\"contentType\":\"image/jpeg\"}\\' class=\"attachment\">\n    <img src=\"image.jpg\">\n    <figcaption data-trix-placeholder=\"Caption\" class=\"caption\">My Image</figcaption>\n</figure>';\n\n$cleaned = Purify::clean($trixContent);\n// Output preserves Trix-specific attributes and elements\necho $cleaned;\n\n```\n\n## Named Configuration Profiles for Purify\n\n```php\n// config/purify.php\nreturn [\n    'default' => 'default',\n\n    'configs' => [\n        'default' => [\n            'HTML.Allowed' => 'p,b,i,a[href]',\n            'AutoFormat.AutoParagraph' => false,\n        ],\n\n        'comments' => [\n            'HTML.Allowed' => 'p,b,i',\n            'HTML.ForbiddenElements' => 'a',\n            'AutoFormat.AutoParagraph' => true,\n        ],\n\n        'posts' => [\n            'HTML.Allowed' => 'h1,h2,h3,p,b,i,ul,ol,li,a[href|title],img[src|alt]',\n            'CSS.AllowedProperties' => 'color,background-color,font-size',\n        ],\n    ],\n];\n\n// Usage in application\nuse Stevebauman\\Purify\\Facades\\Purify;\n\n$commentInput = '<a href=\"#\">Link</a><p>Great post!</p><script>bad();</script>';\n$cleanedComment = Purify::config('comments')->clean($commentInput);\n// Output: '<p>Great post!</p>' (link removed per ForbiddenElements)\n\n$postInput = '<h1>Title</h1><p>Content</p><img src=\"photo.jpg\" alt=\"Photo\">';\n$cleanedPost = Purify::config('posts')->clean($postInput);\n// Output: '<h1>Title</h1><p>Content</p><img src=\"photo.jpg\" alt=\"Photo\">'\n```\n\n## Extend HTML5 Definition with Custom Elements and Attributes in PHP\n\n```php\n// app/Definitions/ExtendedHtml5Definition.php\nnamespace App\\Definitions;\n\nuse HTMLPurifier_HTMLDefinition;\nuse Stevebauman\\Purify\\Definitions\\Definition;\nuse Stevebauman\\Purify\\Definitions\\Html5Definition;\n\nclass ExtendedHtml5Definition implements Definition\n{\n    public static function apply(HTMLPurifier_HTMLDefinition $definition)\n    {\n        // Apply built-in HTML5 definitions first\n        Html5Definition::apply($definition);\n\n        // Add custom elements for your application\n        $definition->addElement('custom-widget', 'Block', 'Flow', 'Common');\n        $definition->addAttribute('custom-widget', 'data-widget-id', 'Number');\n        $definition->addAttribute('custom-widget', 'data-config', 'Text');\n\n        // Extend video with additional attributes\n        $definition->addAttribute('video', 'playsinline', 'Bool');\n        $definition->addAttribute('video', 'muted', 'Bool');\n    }\n}\n\n// config/purify.php\nreturn [\n    'definitions' => \\App\\Definitions\\ExtendedHtml5Definition::class,\n];\n\n// Usage\nuse Stevebauman\\Purify\\Facades\\Purify;\n\n$html5Content = '<article>\n    <header><h1>Title</h1></header>\n    <section>\n        <video src=\"video.mp4\" controls playsinline muted></video>\n        <custom-widget data-widget-id=\"123\" data-config='{\"theme\":\"dark\"}'>\n            <p>Widget content</p>\n        </custom-widget>\n    </section>\n    <footer>Footer</footer>\n</article>';\n\n$cleaned = Purify::clean($html5Content);\n// Output preserves HTML5 semantic elements and custom extensions\necho $cleaned;\n```\n\n## Install Purify Package\n\n```bash\ncomposer require stevebauman/purify\nphp artisan vendor:publish --provider=\"Stevebauman\\Purify\\PurifyServiceProvider\"\n```\n\n## Eloquent Cast: Sanitize HTML on Storage (PHP)\n\n```php\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Stevebauman\\Purify\\Casts\\PurifyHtmlOnSet;\n\nclass Comment extends Model\n{\n    protected function casts(): array\n    {\n        return [\n            'body' => PurifyHtmlOnSet::class,\n        ];\n    }\n}\n\n// Usage\n$comment = new Comment();\n$comment->body = '<script>alert(\"XSS\");</script><p>Nice article!</p>';\n$comment->save();\n\n// Content is sanitized BEFORE saving to database\n// Database stores: '<p>Nice article!</p>'\n\n$retrieved = Comment::find($comment->id);\necho $retrieved->body;\n// Output: '<p>Nice article!</p>'\n\n// Raw value is already clean\necho $retrieved->getRawOriginal('body');\n// Output: '<p>Nice article!</p>'\n\n```\n\n## Eloquent Cast: Sanitize HTML on Retrieval (PHP)\n\n```php\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Stevebauman\\Purify\\Casts\\PurifyHtmlOnGet;\n\nclass Post extends Model\n{\n    // Laravel 11+ syntax\n    protected function casts(): array\n    {\n        return [\n            'content' => PurifyHtmlOnGet::class,\n            'excerpt' => PurifyHtmlOnGet::class,\n        ];\n    }\n\n    // Laravel 10 and earlier syntax\n    // protected $casts = [\n    //     'content' => PurifyHtmlOnGet::class,\n    // ];\n}\n\n// Usage\n$post = new Post();\n$post->content = '<script>alert(\"stored as-is\");</script><p>Safe content</p>';\n$post->save();\n\n// When retrieved, content is automatically sanitized\n$retrieved = Post::find($post->id);\necho $retrieved->content;\n// Output: '<p>Safe content</p>' (script removed on read)\n\n// Raw database value remains unchanged\necho $retrieved->getRawOriginal('content');\n// Output: '<script>alert(\"stored as-is\");</script><p>Safe content</p>'\n\n```\n\n## Clean Single HTML String with Purify\n\n```php\nuse Stevebauman\\Purify\\Facades\\Purify;\n\n// Input with malicious script and disallowed styles\n$input = '<script>alert(\"XSS Attack\");</script> <p style=\"border:1px solid black\" class=\"text-gray-700\">Hello World</p>';\n\n// Clean the input - removes script tags and disallowed attributes\n$cleaned = Purify::clean($input);\n\n// Output: '<p>Hello World</p>'\necho $cleaned;\n```\n\n## Sanitize HTML Content on Get using Eloquent Mutator\n\n```php\nuse Stevebauman\\Purify\\Facades\\Purify;\n\nclass Post extends Model\n{\n    public function getContentAttribute($value)\n    {\n        return Purify::clean($value);\n    }\n}\n```\n\n## Clear HTML Purifier Definition Cache via Artisan Command\n\n```bash\n# Clear cache when definitions or configuration changes\nphp artisan purify:clear\n\n# Output: \"HTML Purifier serializer cache cleared successfully.\"\n```",
    "library": "clean",
    "topic": "overview",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-01-29T22:13:23.732057"
}
{
  "library": "memory_integration",
  "topic": "examples",
  "documentation": {
    "content": "## OneAIFW CLI Examples\n\n```bash\n# Unified call examples (module name changed to aifw)\npython -m aifw direct_call --api-key-file /path/to/api-key.json \"Hello\"\npython -m aifw launch --work-dir ~/.aifw --log-dest file\npython -m aifw call --url http://127.0.0.1:8844 --api-key-file /path/to/api-key.json \"Hello\"\npython -m aifw stop --work-dir ~/.aifw\n```\n\n## Python API: Basic Mask and Restore PII\n\n```python\nfrom services.app.one_aifw_api import OneAIFWAPI\n\n# Initialize API\napi = OneAIFWAPI()\n\n# Mask text\ntext = \"Contact me at john@example.com or call 555-0123\"\nresult = api.mask_text(text, language=\"en\")\nprint(result)\n# Output: {\n#   \"text\": \"Contact me at __PII_EMAIL_ADDRESS_00000001__ or call __PII_PHONE_NUMBER_00000002__\",\n#   \"maskMeta\": \"base64_encoded_metadata...\"\n# }\n\n# Restore text\nrestored = api.restore_text(\n    text=result[\"text\"],\n    mask_meta=result[\"maskMeta\"]\n)\nprint(restored)\n# Output: \"Contact me at john@example.com or call 555-0123\"\n```\n\n## Python API: Full Pipeline with LLM Integration\n\n```python\nfrom services.app.one_aifw_api import OneAIFWAPI\n\napi = OneAIFWAPI()\n\n# Complete mask -> LLM -> restore pipeline\noutput = api.call(\n    text=\"Translate to French: My email is alice@example.com\",\n    api_key_file=\"/path/to/api-key.json\",\n    model=\"gpt-4o-mini\",\n    temperature=0.0\n)\n\nprint(output)\n# Output: \"Traduire en fran\u00e7ais : Mon email est alice@example.com\"\n# (PII is masked before LLM, restored after)\n```\n\n## Mask and Restore Text (Node.js)\n\n```javascript\n// Requires Node 18+ or bring your own fetch polyfill\nconst base = 'http://127.0.0.1:8844';\n\n// 1) Example of mask_text (JSON \u2192 JSON)\nconst jr = await fetch(`${base}/api/mask_text`, {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ text: 'My email is test@example.com' })\n});\nif (!jr.ok) throw new Error(`mask_text http ${jr.status}`);\nconst obj = await jr.json();\nconst maskedText = (obj.output || {}).text;\nconst maskMetaB64 = (obj.output || {}).maskMeta;\nconsole.log('masked:', maskedText);\n\n// 2) Example of restore_text (JSON \u2192 JSON)\nconst rr = await fetch(`${base}/api/restore_text`, {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ text: maskedText, maskMeta: maskMetaB64 })\n});\nif (!rr.ok) throw new Error(`restore_text http ${rr.status}`);\nconst restoredObj = await rr.json();\nconsole.log('restored:', (restoredObj.output || {}).text);\n```\n\n## LLM API Key JSON Configuration\n\n```json\n{\n  \"openai-api-key\": \"xxxxxxxx.xxxx\",\n  \"openai-base-url\": \"https://api.openai.com/v1\",\n  \"openai-model\": \"gpt-4o-mini\"\n}\n```\n\n## Initialize and Configure aifw-js with UI Options\n\n```javascript\nimport * as aifw from './vendor/aifw-js/aifw-js.js';\n\nconst statusEl = document.getElementById('status');\nconst textEl = document.getElementById('text');\nconst maskedEl = document.getElementById('masked');\nconst restoredEl = document.getElementById('restored');\nconst runBtn = document.getElementById('run');\n\nfunction getMaskConfigFromUI() {\n  const byId = (id) => {\n    const el = document.getElementById(id);\n    return !!(el && el.checked);\n  };\n  return {\n    maskAddress: byId('maskAddress'),\n    maskEmail: byId('maskEmail'),\n    maskOrganization: byId('maskOrganization'),\n    maskUserName: byId('maskUserName'),\n    maskPhoneNumber: byId('maskPhoneNumber'),\n    maskBankNumber: byId('maskBankNumber'),\n    maskPayment: byId('maskPayment'),\n    maskVerificationCode: byId('maskVerificationCode'),\n    maskPassword: byId('maskPassword'),\n    maskRandomSeed: byId('maskRandomSeed'),\n    maskPrivateKey: byId('maskPrivateKey'),\n    maskUrl: byId('maskUrl'),\n  };\n}\n\nasync function main() {\n  statusEl.textContent = 'Initializing AIFW...';\n  await aifw.init({\n    maskConfig: getMaskConfigFromUI()\n  });\n  statusEl.textContent = 'AIFW initialized.';\n\n  let shutdownCalled = false;\n  function shutdownOnce() {\n    if (shutdownCalled) return;\n    shutdownCalled = true;\n    aifw.deinit();\n  }\n  window.addEventListener('pagehide', shutdownOnce, { once: true });\n  window.addEventListener('beforeunload', shutdownOnce, { once: true });\n\n  const maskIds = [\n    'maskAddress',\n    'maskEmail',\n    'maskOrganization',\n    'maskUserName',\n    'maskPhoneNumber',\n    'maskBankNumber',\n    'maskPayment',\n    'maskVerificationCode',\n    'maskPassword',\n    'maskRandomSeed',\n    'maskPrivateKey',\n    'maskUrl',\n  ];\n\n  for (const id of maskIds) {\n    const el = document.getElementById(id);\n    if (!el) continue;\n    el.addEventListener('change', () => {\n      if (!aifw || typeof aifw.config !== 'function') return;\n      const cfg = getMaskConfigFromUI();\n      aifw.config(cfg).catch((e) => console.warn('[offline] config failed', e));\n    });\n  }\n\n  runBtn.addEventListener('click', async () => {\n    try {\n      statusEl.textContent = 'Running...';\n      maskedEl.textContent = '';\n      restoredEl.textContent = '';\n      const textStr = textEl.value || '';\n      const lines = textStr.split(/\\r?\\n/);\n      let language = (document.getElementById('lang')?.value) || 'auto';\n      const useBatch = !!document.getElementById('use-batch')?.checked;\n\n      let maskedLines = [];\n      let metas = [];\n\n      if (language === 'auto') {\n        try {\n          const det = await aifw.detectLanguage(textStr);\n          const show = det && det.lang === 'zh' ? (det.script === 'Hant' ? 'zh-TW' : 'zh-CN') : (det && det.lang) || '';\n          const span = document.getElementById('lang-detected');\n          if (span) span.textContent = show ? `(detected: ${show})` : '';\n        } catch (e) {}\n        language = null;\n      }\n\n      if (useBatch) {\n        const inputs = lines.map((line) => ({ text: line, language }));\n        const results = await aifw.maskTextBatch(inputs);\n        maskedLines = results.map((r) => (r && r.text) || '');\n        metas = results.map((r) => r && r.maskMeta);\n      } else {\n        for (const line of lines) {\n          const [masked, meta] = await aifw.maskText(line, language);\n          maskedLines.push(masked);\n          metas.push(meta);\n        }\n      }\n\n      const maskedStr = maskedLines.join('\\n');\n      maskedEl.textContent = maskedStr;\n\n      const batchItems = maskedLines.map((m, i) => ({ text: m, maskMeta: metas[i] }));\n      const restoredObjs = await aifw.restoreTextBatch(batchItems);\n      const restoredStr = restoredObjs.map((o) => (o && o.text) || '').join('\\n');\n      restoredEl.textContent = restoredStr;\n\n      try {\n        const test_text = \"Hi, my email is example.test@funstory.com, my phone number is 13800138027, my name is John Doe\";\n        const [masked, meta] = await aifw.maskText(test_text, language);\n        const emptied = await aifw.restoreText('', meta);\n        console.log('[webapp] empty-restore result length:', emptied.length);\n      } catch (e) {\n        console.warn('[webapp] empty-restore check failed:', e);\n      }\n\n      try {\n        const spans = await aifw.getPiiSpans(textStr, language);\n        console.log('[webapp] getPiiSpans spans:', spans);\n      } catch (e) {\n        console.warn('[webapp] getPiiSpans failed:', e);\n      }\n\n      statusEl.textContent = 'Done';\n    } catch (e) {\n      statusEl.textContent = `Error: ${e.message || e}`;\n    }\n  });\n}\n\nmain().catch((e) => statusEl.textContent = `Error: ${e.message || e}`);\n\n```\n\n## OneAIFW API Key JSON Configuration\n\n```json\n{\n  \"openai-api-key\": \"sk-proj-abc123...\",\n  \"openai-base-url\": \"https://api.openai.com/v1\",\n  \"openai-model\": \"gpt-4o-mini\"\n}\n```\n\n## Docker: Using the image to run aifw commands\n\n```APIDOC\n## Docker: Using the image to run aifw commands\n\n### Description\nThis section provides instructions for running OneAIFW commands interactively within a Docker container, including starting/stopping the server and executing specific tasks.\n\n### 1. Run in interactive mode\n```bash\ndocker run -it --name aifw \\\n  -p 8844:8844 \\\n  -e AIFW_API_KEY_FILE=/data/aifw/your-key.json \\\n  -v $HOME/.aifw:/data/aifw \\\n  oneaifw:latest \\\n  /bin/bash\n```\n\n### 2. Start the OneAIFW server\nInside the container:\n```bash\npython -m aifw launch\n```\n\n### 3. Call the OneAIFW for translate text or other tasks\nInside the container:\n```bash\npython -m aifw call \"\u8bf7\u628a\u5982\u4e0b\u6587\u672c\u7ffb\u8bd1\u4e3a\u4e2d\u6587: My email address is test@example.com, and my phone number is 18744325579.\"\n```\n\n### 4. Stop the OneAIFW server\nInside the container:\n```bash\npython -m aifw stop\n```\n\n### 5. Exit the Docker container and cleanup\nInside the container, run `exit`. Then on the host:\n```bash\ndocker rm -f aifw\n```\n```\n\n## Run Web Demo\n\n```bash\ncd apps/webapp\npnpm dev\n```\n\n## Build OneAIFW Docker Images with spaCy Profiles\n\n```bash\ncd py-origin\n\n# Build minimal\ndocker build -t oneaifw:minimal .\n\n# Build French / German / Japanese\ndocker build --build-arg SPACY_PROFILE=fr -t oneaifw:fr .\ndocker build --build-arg SPACY_PROFILE=de -t oneaifw:de .\ndocker build --build-arg SPACY_PROFILE=ja -t oneaifw:ja .\n\n# Build multi-language\ndocker build --build-arg SPACY_PROFILE=multi -t oneaifw:multi .\n```",
    "library": "anonymization",
    "topic": "examples",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-01-30T18:32:13.848560"
}
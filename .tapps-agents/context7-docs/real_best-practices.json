{
  "library": "real",
  "topic": "best-practices",
  "documentation": {
    "content": "## Go Health Check Implementation\n\n```go\npackage main\n\nimport (\n\t\"context\"\n\t\"database/sql\"\n\t\"fmt\"\n\t\"github.com/alexliesenfeld/health\"\n\t_ \"github.com/mattn/go-sqlite3\"\n\t\"log\"\n\t\"net/http\"\n\t\"time\"\n)\n\n// This is a very simple example that shows the basic features of this library.\nfunc main() {\n\tdb, _ := sql.Open(\"sqlite3\", \"simple.sqlite\")\n\tdefer db.Close()\n\n\t// Create a new Checker.\n\tchecker := health.NewChecker(\n\t\t\n\t\t// Set the time-to-live for our cache to 1 second (default).\n\t\thealth.WithCacheDuration(1*time.Second),\n\n\t\t// Configure a global timeout that will be applied to all checks.\n\t\thealth.WithTimeout(10*time.Second),\n\n\t\t// A check configuration to see if our database connection is up.\n\t\t// The check function will be executed for each HTTP request.\n\t\thealth.WithCheck(health.Check{\n\t\t\tName:    \"database\",      // A unique check name.\n\t\t\tTimeout: 2 * time.Second, // A check specific timeout.\n\t\t\tCheck:   db.PingContext,\n\t\t}),\n\n\t\t// The following check will be executed periodically every 15 seconds\n\t\t// started with an initial delay of 3 seconds. The check function will NOT\n\t\t// be executed for each HTTP request.\n\t\thealth.WithPeriodicCheck(15*time.Second, 3*time.Second, health.Check{\n\t\t\tName: \"search\",\n\t\t\t// The check function checks the health of a component. If an error is\n\t\t\t// returned, the component is considered unavailable (or \"down\").\n\t\t\t// The context contains a deadline according to the configured timeouts.\n\t\t\tCheck: func(ctx context.Context) error {\n\t\t\t\treturn fmt.Errorf(\"this makes the check fail\")\n\t\t\t},\n\t\t}),\n\n\t\t// Set a status listener that will be invoked when the health status changes.\n\t\t// More powerful hooks are also available (see docs).\n\t\thealth.WithStatusListener(func(ctx context.Context, state health.CheckerState) {\n\t\t\tlog.Println(fmt.Sprintf(\"health status changed to %s\", state.Status))\n\t\t}),\n\t))\n\n\t// Create a new health check http.Handler that returns the health status\n\t// serialized as a JSON string. You can pass pass further configuration\n\t// options to NewHandler to modify default configuration.\n\thttp.Handle(\"/health\", health.NewHandler(checker))\n\tlog.Fatalln(http.ListenAndServe(\":3000\", nil))\n}\n\n```\n\n## Combine Synchronous and Periodic Health Checks in Go\n\n```go\nchecker := health.NewChecker(\n    health.WithTimeout(10*time.Second),\n    health.WithCacheDuration(1*time.Second),\n\n    // Fast synchronous check\n    health.WithCheck(health.Check{\n        Name:    \"memory\",\n        Timeout: 100 * time.Millisecond,\n        Check: func(ctx context.Context) error {\n            var m runtime.MemStats\n            runtime.ReadMemStats(&m)\n            if m.Alloc > 1024*1024*1024 { // 1GB\n                return fmt.Errorf(\"memory usage too high: %d bytes\", m.Alloc)\n            }\n            return nil\n        },\n    }),\n\n    // Expensive periodic check\n    health.WithPeriodicCheck(30*time.Second, 0, health.Check{\n        Name: \"disk-space\",\n        Check: func(ctx context.Context) error {\n            var stat syscall.Statfs_t\n            syscall.Statfs(\"/var/log\", &stat)\n            available := stat.Bavail * uint64(stat.Bsize)\n            if available < 1024*1024*100 { // 100MB\n                return fmt.Errorf(\"low disk space: %d bytes available\", available)\n            }\n            return nil\n        },\n    }),\n)\n```\n\n## Using Middleware for Health Check Interception in Go\n\n```Go\nimport (\n\t\"context\"\n\n\t\"github.com/alexliesenfeld/health/middleware\"\n)\n\nfunc setupHealthMiddleware() {\n\t// Example: Using BasicLogger middleware\n\tvar loggerMiddleware health.MiddlewareFunc\n\tloggerMiddleware = middleware.BasicLogger(nil) // Pass a logger implementation if needed\n\n\t// Example: Using FullDetailsOnQueryParam middleware\n\tvar detailsMiddleware health.MiddlewareFunc\n\tdetailsMiddleware = middleware.FullDetailsOnQueryParam(\"healthcheck\")\n\n\t// These middleware functions can be combined or applied as needed when configuring the health checker.\n\t// For instance, when creating a new health checker:\n\t// checker := health.NewChecker(\n\t// \thealth.WithMiddleware(loggerMiddleware, detailsMiddleware),\n\t// \t// ... other health check configurations\n\t// )\n}\n```\n\n## Integrate Health Checks with Kubernetes Probes in Go and YAML\n\n```go\nfunc main() {\n    checker := health.NewChecker(\n        health.WithPeriodicCheck(15*time.Second, 0, health.Check{\n            Name: \"database\",\n            Check: db.PingContext,\n        }),\n    )\n\n    http.Handle(\"/healthz\", health.NewHandler(checker))\n    http.ListenAndServe(\":8080\", nil)\n}\n```\n\n## Integrate Health Checks with Kubernetes Probes in Go and YAML\n\n```yaml\n# kubernetes/deployment.yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: myapp\nspec:\n  containers:\n  - name: myapp\n    image: myapp:latest\n    ports:\n    - containerPort: 8080\n    livenessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n      initialDelaySeconds: 10\n      periodSeconds: 15\n      timeoutSeconds: 5\n      failureThreshold: 3\n    readinessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n      initialDelaySeconds: 5\n      periodSeconds: 10\n      timeoutSeconds: 3\n      failureThreshold: 2\n```\n\n## Listening to Health Status Changes in Go\n\n```Go\nimport (\n\t\"context\"\n\t\"log\"\n\t\"time\"\n\n\t\"github.com/alexliesenfeld/health\"\n)\n\nfunc setupHealthListeners(ctx context.Context) {\n\t// Listener for individual component status changes\n\thealth.WithPeriodicCheck(5*time.Second, 0, health.Check{\n\t\tName:   \"search\",\n\t\tCheck:  myCheckFunc, // Assume myCheckFunc is defined elsewhere\n\t\tStatusListener: func (ctx context.Context, name string, state health.CheckState) {\n\t\t\tlog.Printf(\"status of component '%s' changed to %s\", name, state.Status)\n\t\t},\n\t}),\n\n\t// Listener for overall system health status changes\n\thealth.WithStatusListener(func (ctx context.Context, state health.CheckerState) {\n\t\tlog.Printf(\"overall system health status changed to %s\", state.Status)\n\t}),\n}\n\n// Placeholder for the actual check function\nfunc myCheckFunc(ctx context.Context) error {\n\t// Implement your health check logic here\n\treturn nil\n}\n```\n\n## Apply Middleware to Health Check Requests\n\n```go\nimport (\n    \"github.com/alexliesenfeld/health\"\n    \"github.com/alexliesenfeld/health/middleware\"\n)\n\nchecker := health.NewChecker(\n    health.WithCheck(health.Check{\n        Name: \"database\",\n        Check: db.PingContext,\n    }),\n)\n\nhandler := health.NewHandler(checker,\n    health.WithMiddleware(\n        // Log all health check requests\n        middleware.BasicLogger(),\n\n        // Require authentication to see details\n        middleware.BasicAuth(\"admin\", \"secret\"),\n\n        // Show details only if ?full query param present\n        middleware.FullDetailsOnQueryParam(\"full\"),\n    ),\n)\n\nhttp.Handle(\"/health\", handler)\n\n// Request without auth: returns only aggregated status\n// curl http://localhost:3000/health\n// {\"status\": \"up\"}\n\n// Request with auth: returns full details\n// curl -u admin:secret http://localhost:3000/health\n// {\"status\": \"up\", \"details\": {\"database\": {\"status\": \"up\", ...}}}\n\n// Request with query param: returns full details\n// curl http://localhost:3000/health?full\n// {\"status\": \"up\", \"details\": {\"database\": {\"status\": \"up\", ...}}}\n\n```\n\n## Integrate InVisionApp/go-health HTTP Check\n\n```go\nimport \"github.com/InVisionApp/go-health/checkers\"\n...\n// Create check as usual (no error checking for brevity)\ngoogleURL, err := url.Parse(\"https://www.google.com\")\ncheck, err := checkers.NewHTTP(&checkers.HTTPConfig{\n    URL: googleURL,\n})\n...\n// Add the check in the Checker configuration.\nhealth.WithCheck(health.Check{\n    Name: \"google\",\n    Check: func(_ context.Context) error {\n        _, err := check.Status() \n        return err\n    },\n})\n```\n\n## Mixed Execution Models\n\n```APIDOC\n## GET /health (Mixed Checks)\n\n### Description\nThis configuration demonstrates combining fast synchronous checks (e.g., memory usage) with potentially slower periodic checks (e.g., disk space) to provide a comprehensive and responsive health status.\n\n### Method\nGET\n\n### Endpoint\n/health\n\n### Parameters\nNone\n\n### Request Example\nNone\n\n### Response\n#### Success Response (200)\n- **status** (string) - Overall health status ('up').\n- **details** (object) - Health status of components.\n  - **memory** (object)\n    - **status** (string) - Component status ('up').\n    - **timestamp** (string) - ISO 8601 timestamp of the check.\n  - **disk-space** (object)\n    - **status** (string) - Component status ('up').\n    - **timestamp** (string) - ISO 8601 timestamp of the last periodic check.\n\n#### Response Example (Success)\n```json\n{\n  \"status\": \"up\",\n  \"details\": {\n    \"memory\": {\n      \"status\": \"up\",\n      \"timestamp\": \"2025-12-04T10:40:00Z\"\n    },\n    \"disk-space\": {\n      \"status\": \"up\",\n      \"timestamp\": \"2025-12-04T10:30:00Z\"\n    }\n  }\n}\n```\n\n#### Response Example (One Component Down)\n```json\n{\n  \"status\": \"down\",\n  \"details\": {\n    \"memory\": {\n      \"status\": \"up\",\n      \"timestamp\": \"2025-12-04T10:40:00Z\"\n    },\n    \"disk-space\": {\n      \"status\": \"down\",\n      \"timestamp\": \"2025-12-04T10:30:00Z\",\n      \"error\": \"low disk space: 50000000 bytes available\"\n    }\n  }\n}\n```\n```\n\n## Integrate etherlabsio/healthcheck Disk Space Check\n\n```go\nimport \"github.com/etherlabsio/healthcheck/v2/checkers\"\n...\nhealth.WithCheck(health.Check{\n    Name:    \"database\",\n    Check:   checkers.DiskSpace(\"/var/log\", 90).Check,\n})\n```\n\n## Integrate hellofresh/health-go HTTP Check\n\n```go\nimport httpCheck \"github.com/hellofresh/health-go/v4/checks/http\"\n...\nhealth.WithCheck(health.Check{\n   Name:    \"google\",\n   Check:   httpCheck.New(httpCheck.Config{\n      URL: \"https://www.google.com\",\n   }),\n}),\n```",
    "library": "health",
    "topic": "best-practices",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-02-03T18:26:00.896437"
}
{
  "library": "concurrent",
  "topic": "common-mistakes",
  "documentation": {
    "content": "## Initialize Task Recovery System in TypeScript\n\n```typescript\nimport { Store } from './lib/store.js';\nimport { LogService } from './lib/log-service.js';\n\nasync function initializeRecovery() {\n  const store = new Store();\n  const logger = new LogService();\n\n  console.log('Initializer starting recovery process...');\n\n  try {\n    // Get all projects marked as processing\n    const processingProjects = await store.redis.smembers('context7:processing');\n\n    console.log(`Found ${processingProjects.length} interrupted tasks`);\n\n    for (const projectId of processingProjects) {\n      // Check project validity\n      const project = await store.getProject(projectId);\n\n      if (!project) {\n        console.log(`Removing invalid project: ${projectId}`);\n        await store.redis.srem('context7:processing', projectId);\n        continue;\n      }\n\n      // Re-queue for processing\n      await store.redis.rpush('context7:queue', JSON.stringify({ projectId }));\n      await store.redis.srem('context7:processing', projectId);\n      await store.updateProjectStatus(projectId, 'queued');\n\n      await logger.info(projectId, 'Task recovered and re-queued');\n      console.log(`\u2713 Recovered: ${projectId}`);\n    }\n\n    console.log('Recovery complete');\n    process.exit(0);\n\n  } catch (error) {\n    console.error('Recovery failed:', error);\n    process.exit(1);\n  }\n}\n\n// Run recovery\ninitializeRecovery();\n```\n\n## Demonstrate Structured Logging in TypeScript\n\n```typescript\nimport { LogService } from './lib/log-service.js';\n\nconst logger = new LogService();\n\nasync function demonstrateLogging(projectId: string) {\n  // Info level\n  await logger.info(projectId, 'Starting file analysis');\n\n  // Warning level\n  await logger.warn(projectId, 'Large file detected, may take longer', {\n    file: 'src/large-bundle.js',\n    size: 5242880\n  });\n\n  // Error level\n  await logger.error(projectId, 'Failed to parse file', {\n    file: 'src/broken.ts',\n    error: 'Unexpected token',\n    line: 42\n  });\n\n  // Retrieve logs\n  const logs = await logger.getLogs(projectId, { limit: 50 });\n\n  logs.forEach(log => {\n    console.log(`[${log.timestamp}] ${log.level}: ${log.message}`);\n    if (log.metadata) {\n      console.log('  Metadata:', JSON.stringify(log.metadata, null, 2));\n    }\n  });\n}\n\n// Usage\nawait demonstrateLogging('proj_abc123def456');\n```\n\n## Configure Environment Variables (.env file)\n\n```bash\n# .env file structure\nUPSTASH_REDIS_URL=https://your-redis.upstash.io\nUPSTASH_REDIS_TOKEN=your_redis_token\n\nUPSTASH_VECTOR_URL=https://your-vector.upstash.io\nUPSTASH_VECTOR_TOKEN=your_vector_token\n\nANTHROPIC_API_KEY=sk-ant-api-key\nOPENAI_API_KEY=sk-openai-key\nGOOGLE_API_KEY=google-gemini-key\n\nPORT=3000\nNODE_ENV=production\nLOG_LEVEL=info\n\n# Optional: Docker mode detection\n# Automatically detected via /.dockerenv\n# Use --local flag to override in development\n\n```\n\n## Background Worker for Task Processing in TypeScript\n\n```typescript\n// worker.ts implementation\nimport { Store } from './lib/store.js';\nimport { TaskProcessor } from './lib/task-processor.js';\nimport { LogService } from './lib/log-service.js';\n\nconst QUEUE_KEY = 'context7:queue';\nconst PROCESSING_KEY = 'context7:processing';\nconst WAITLIST_KEY = 'context7:waitlist';\n\nasync function startWorker() {\n  const store = new Store();\n  const logger = new LogService();\n  const processor = new TaskProcessor(logger);\n\n  console.log('Worker started, polling for tasks...');\n\n  while (true) {\n    try {\n      // Pop task from queue\n      const task = await store.redis.lpop(QUEUE_KEY);\n\n      if (!task) {\n        await sleep(5000);\n        continue;\n      }\n\n      const projectId = JSON.parse(task).projectId;\n\n      // Mark as processing\n      await store.redis.sadd(PROCESSING_KEY, projectId);\n      await store.updateProjectStatus(projectId, 'processing');\n\n      // Process the project\n      await processor.processProject(projectId);\n\n      // Mark as completed\n      await store.redis.srem(PROCESSING_KEY, projectId);\n      await store.updateProjectStatus(projectId, 'completed');\n\n      console.log(`\u2713 Completed: ${projectId}`);\n\n    } catch (error) {\n      console.error(`\u2717 Error processing task:`, error);\n      await handleTaskError(error);\n    }\n  }\n}\n\nfunction sleep(ms: number) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n// Start the worker\nstartWorker().catch(console.error);\n```\n\n## Submit Repository for Parsing with cURL\n\n```bash\ncurl -X POST https://api.context7.com/api/parse \\\n  -H \"Content-Type: application/json\" \\\n  -d '{ \\\n    \"url\": \"https://github.com/username/repo\", \\\n    \"type\": \"repository\", \\\n    \"options\": { \\\n      \"includeTests\": true, \\\n      \"maxDepth\": 5, \\\n      \"excludePatterns\": [\"node_modules\", \"dist\", \".git\"] \\\n    } \\\n  }'\n\n# Response\n{\n  \"success\": true,\n  \"projectId\": \"proj_abc123def456\",\n  \"status\": \"queued\",\n  \"estimatedTime\": 120,\n  \"message\": \"Project queued for parsing\"\n}\n\n# Error handling\n{\n  \"success\": false,\n  \"error\": \"Invalid repository URL\",\n  \"code\": \"INVALID_URL\"\n}\n```\n\n## Search Project Context with cURL\n\n```bash\ncurl -X GET \"https://api.context7.com/api/search?projectId=proj_abc123def456&query=authentication+middleware&limit=10\"\n\n# Response\n{\n  \"results\": [\n    {\n      \"file\": \"src/middleware/auth.ts\",\n      \"lines\": \"45-78\",\n      \"score\": 0.92,\n      \"content\": \"export const authenticateUser = async (req, res, next) => {...}\",\n      \"context\": \"Authentication middleware with JWT validation\"\n    },\n    {\n      \"file\": \"src/services/auth.service.ts\",\n      \"lines\": \"120-156\",\n      \"score\": 0.87,\n      \"content\": \"class AuthenticationService {...}\",\n      \"context\": \"Core authentication service implementation\"\n    }\n  ],\n  \"totalResults\": 2,\n  \"queryTime\": 45\n}\n```\n\n## End-to-End Test for Project Parsing (TypeScript)\n\n```typescript\n// test/e2e/parse.test.ts\nimport { describe, it, expect } from 'vitest';\nimport { parseProject, getProject } from '../utils/api.js';\n\ndescribe('Project Parsing E2E', () => {\n  it('should parse a GitHub repository successfully', async () => {\n    const response = await parseProject({\n      url: 'https://github.com/test/sample-repo',\n      type: 'repository',\n      options: { includeTests: false }\n    });\n\n    expect(response.success).toBe(true);\n    expect(response.projectId).toBeDefined();\n\n    // Wait for processing\n    await waitForCompletion(response.projectId, 60000);\n\n    const project = await getProject(response.projectId);\n    expect(project.status).toBe('completed');\n    expect(project.stats.totalFiles).toBeGreaterThan(0);\n    expect(project.contextFile).toBeDefined();\n  }, 120000);\n\n  it('should handle invalid repository URLs', async () => {\n    await expect(\n      parseProject({ url: 'not-a-url', type: 'repository' })\n    ).rejects.toThrow('Invalid repository URL');\n  });\n});\n\n// Run tests\n// npm run test:e2e:parse\n\n```\n\n## DELETE /api/project/:id - Remove Project\n\n```APIDOC\n## DELETE /api/project/:id - Remove Project\n\n### Description\nDelete a project and all associated data including context files, embeddings, and metadata.\n\n### Method\nDELETE\n\n### Endpoint\n/api/project/:id\n\n### Parameters\n#### Path Parameters\n- **id** (string) - Required - The unique identifier of the project to delete.\n\n#### Headers\n- **Authorization** (string) - Required - Bearer token for authentication (e.g., \"Bearer your_admin_token\").\n\n### Response\n#### Success Response (200)\n- **success** (boolean) - Indicates if the project was successfully deleted.\n- **projectId** (string) - The unique identifier of the deleted project.\n\n#### Response Example\n```json\n{\n  \"success\": true,\n  \"projectId\": \"proj_abc123def456\"\n}\n```\n```\n\n## POST /api/parse - Submit Repository for Parsing\n\n```APIDOC\n## POST /api/parse - Submit Repository for Parsing\n\n### Description\nSubmit a code repository or website URL for contextual analysis. The system queues the request, processes the content, generates embeddings, and stores structured context data.\n\n### Method\nPOST\n\n### Endpoint\n/api/parse\n\n### Parameters\n#### Request Body\n- **url** (string) - Required - The URL of the repository or website to parse.\n- **type** (string) - Required - The type of content to parse, e.g., \"repository\" or \"website\".\n- **options** (object) - Optional - Additional parsing options.\n  - **includeTests** (boolean) - Optional - Whether to include test files.\n  - **maxDepth** (integer) - Optional - Maximum depth for crawling websites or exploring repository structure.\n  - **excludePatterns** (array of strings) - Optional - Patterns for files or directories to exclude from parsing.\n\n### Request Example\n```json\n{\n  \"url\": \"https://github.com/username/repo\",\n  \"type\": \"repository\",\n  \"options\": {\n    \"includeTests\": true,\n    \"maxDepth\": 5,\n    \"excludePatterns\": [\"node_modules\", \"dist\", \".git\"]\n  }\n}\n```\n\n### Response\n#### Success Response (200)\n- **success** (boolean) - Indicates if the request was successful.\n- **projectId** (string) - The unique identifier for the parsing project.\n- **status** (string) - The initial status of the project (e.g., \"queued\").\n- **estimatedTime** (integer) - Estimated time in minutes for the parsing to complete.\n- **message** (string) - A confirmation message.\n\n#### Error Response (4xx/5xx)\n- **success** (boolean) - Indicates failure.\n- **error** (string) - A message describing the error.\n- **code** (string) - An error code.\n\n#### Response Example (Success)\n```json\n{\n  \"success\": true,\n  \"projectId\": \"proj_abc123def456\",\n  \"status\": \"queued\",\n  \"estimatedTime\": 120,\n  \"message\": \"Project queued for parsing\"\n}\n```\n\n#### Response Example (Error)\n```json\n{\n  \"success\": false,\n  \"error\": \"Invalid repository URL\",\n  \"code\": \"INVALID_URL\"\n}\n```\n```\n\n## GET /api/search - Search Project Context\n\n```APIDOC\n## GET /api/search - Search Project Context\n\n### Description\nQuery the vector embeddings to find relevant code sections based on semantic similarity.\n\n### Method\nGET\n\n### Endpoint\n/api/search\n\n### Parameters\n#### Query Parameters\n- **projectId** (string) - Required - The unique identifier of the project to search within.\n- **query** (string) - Required - The search query string.\n- **limit** (integer) - Optional - The maximum number of results to return. Defaults to 10.\n\n### Response\n#### Success Response (200)\n- **results** (array of objects) - A list of search results.\n  - **file** (string) - The file path where the result was found.\n  - **lines** (string) - The line range within the file.\n  - **score** (float) - The similarity score of the result.\n  - **content** (string) - The relevant code snippet.\n  - **context** (string) - A brief description of the context.\n- **totalResults** (integer) - The total number of results found.\n- **queryTime** (integer) - The time taken for the query in milliseconds.\n\n#### Response Example\n```json\n{\n  \"results\": [\n    {\n      \"file\": \"src/middleware/auth.ts\",\n      \"lines\": \"45-78\",\n      \"score\": 0.92,\n      \"content\": \"export const authenticateUser = async (req, res, next) => {...}\",\n      \"context\": \"Authentication middleware with JWT validation\"\n    },\n    {\n      \"file\": \"src/services/auth.service.ts\",\n      \"lines\": \"120-156\",\n      \"score\": 0.87,\n      \"content\": \"class AuthenticationService {...}\",\n      \"context\": \"Core authentication service implementation\"\n    }\n  ],\n  \"totalResults\": 2,\n  \"queryTime\": 45\n}\n```\n```",
    "library": "context7",
    "topic": "common-mistakes",
    "source": "fuzzy_match"
  },
  "source": "fuzzy_match",
  "saved_at": "2026-01-30T14:25:20.447804"
}